(this.webpackJsonpgenify=this.webpackJsonpgenify||[]).push([[0],{199:function(e){e.exports=JSON.parse('{"logs":[{"version":"3.0.3","changes":["Updated icon and added for mobile devices","Fixed [issue 7](https://github.com/JoshLmao/Genify/issues/7) where the white space from Genius was unexpected","Implemented a fix for [issue 8](https://github.com/JoshLmao/Genify/issues/8) causing app to crash and auth to not get updated"]},{"version":"3.0.2","changes":["Implemented new Spotify auth path: [Proof Key for Code Exchange](https://developer.spotify.com/documentation/general/guides/authorization-guide/#authorization-code-flow-with-proof-key-for-code-exchange-pkce)","Lyrics only get updated when track change"]},{"version":"3.0.1","changes":["Fixed the app using expired auth causing no access"]},{"version":"3.0.0: The React Update \ud83c\udf89","changes":["Changed site to use React","Site speed improved by a lot","Removed Youtube video player and options (for now)","Removed ability to change Spotify playback device (for now)","Improved overall app flow for getting user authorization","Added information about current Genius lyrics","Able to detect and romanize Russian lyrics","Can set the current playback time of the current Spotify track","User can set volume of current playback device","Can view and navigate to all artists on current track"]}]}')},210:function(e,t,a){e.exports=a(438)},238:function(e,t){},240:function(e,t){},251:function(e,t){},253:function(e,t){},278:function(e,t){},280:function(e,t){},281:function(e,t){},287:function(e,t){},289:function(e,t){},307:function(e,t){},310:function(e,t){},326:function(e,t){},329:function(e,t){},332:function(e,t,a){},413:function(e){e.exports=JSON.parse('{"name":"genify","version":"3.0.3","homepage":"https://genify.joshlmao.com","private":true,"dependencies":{"@fortawesome/fontawesome-svg-core":"^1.2.29","@fortawesome/free-brands-svg-icons":"^5.13.1","@fortawesome/free-solid-svg-icons":"^5.13.1","@fortawesome/react-fontawesome":"^0.1.11","@testing-library/jest-dom":"^4.2.4","@testing-library/react":"^9.5.0","@testing-library/user-event":"^7.2.1","aromanize":"^0.1.5","axios":"^0.19.2","bootstrap":"^4.5.0","crypto-js":"^4.0.0","cyrillic-to-translit-js":"^3.1.0","kuroshiro":"^1.1.2","kuroshiro-analyzer-kuromoji":"^1.1.0","pinyin4js":"^1.3.18","react":"^16.13.1","react-bootstrap":"^1.1.1","react-bootstrap-range-slider":"^1.0.0","react-dom":"^16.13.1","react-markdown":"^4.3.1","react-router-dom":"^5.2.0","react-scripts":"3.4.1","traditional-or-simplified":"^1.0.3"},"scripts":{"predeploy":"npm run build","deploy":"gh-pages -d build -m \\"Updated live build to the latest changes\\"","start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject"},"eslintConfig":{"extends":"react-app"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"gh-pages":"^3.1.0"}}')},434:function(e,t,a){},437:function(e,t,a){},438:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(40),i=a.n(r);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var s=a(9),l=a(10),c=a(19),u=a(18),h=a(49),m=a(11),d=a(8),p=a(440),f=a(441),g=a(442),y=a(446),v=a(15),b=a(52),k="dZ7Y5s8PMg_oljOH1DgF_PDXXp-GvzF3g1OMlXh08Af~5J5hosQPQ4eNILnSf3IK.SKtnWlgANdHC.1.wSBw0ZqxtxBRsD7vkGV_f67RBa4DoFo0O3mrz5wB-3e17TsK",E="jZPEvjdl6Sk1RJUDoo0tTuEFYv2B8rbosLsOUnFBqbi11dCtfftjiN911-a9q0lo",S="https://genify-proxy.herokuapp.com/";var x=a(41),C=a.n(x),N=a(195),w=a.n(N),T=a(196),j=a.n(T);function P(e){var t=[];for(var a in e){var n=encodeURIComponent(a),o=encodeURIComponent(e[a]);t.push(n+"="+o)}return t=t.join("&")}var A={getPKCEAuthUri:function(){var e=encodeURIComponent("https://genify.joshlmao.com/callback"),t=encodeURIComponent(["streaming","user-read-currently-playing","user-read-playback-state","user-modify-playback-state","app-remote-control","user-read-email","user-read-private"].join(" ")),a=this.encodePKCEChallenge(k),n=a.method,o=a.challenge;return"https://accounts.spotify.com/authorize?"+["response_type=".concat("code"),"client_id=".concat("f4dc97c399124fc99254c5d7ac2bf4bd"),"redirect_uri=".concat(e),"code_challenge=".concat(o),"code_challenge_method=".concat(n),"state=".concat("jhkmsdgfiudf3243"),"scope=".concat(t)].join("&")},encodePKCEChallenge:function(e){var t=w()(e);return{method:"S256",challenge:j.a.stringify(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}},exchangePKCECode:function(e,t){var a=P({grant_type:encodeURIComponent("authorization_code"),client_id:encodeURIComponent("f4dc97c399124fc99254c5d7ac2bf4bd"),code:encodeURIComponent(e),redirect_uri:"https://genify.joshlmao.com/callback",code_verifier:encodeURIComponent(k)});C()({method:"POST",url:"https://accounts.spotify.com/api/token",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},data:a,timeout:3e4}).then((function(e){t&&t(e.data)})).catch((function(e){console.error(e),console.error(e.response.data)}))},parseAuth:function(e){if(!e)return null;var t=e.expires_in,a=this.getAuthExpireTime(t),n=e.scope.split(" ");return{authToken:e.access_token,tokenType:e.token_type,scopes:n,refreshToken:e.refresh_token,expireDate:a}},refreshAuth:function(e,t){var a=this;if(e){var n=P({grant_type:encodeURIComponent("refresh_token"),refresh_token:e,client_id:encodeURIComponent("f4dc97c399124fc99254c5d7ac2bf4bd")});C()({method:"POST",url:"https://accounts.spotify.com/api/token",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},data:n,timeout:3e4}).then((function(e){t&&t(e.data)})).catch((function(e){a.handleApiError(e)}))}return null},handleApiError:function(e,t){var a,n,o,r;console.error("Spotify API Error: '".concat(t,"': '").concat(null!==(a=null===e||void 0===e||null===(n=e.response)||void 0===n||null===(o=n.data)||void 0===o||null===(r=o.error)||void 0===r?void 0:r.message)&&void 0!==a?a:e,"'"))},getAuthExpireTime:function(e){return new Date(Date.now()+1e3*e)},makeApiRequest:function(e,t,a,n){var o=this;C()({method:e,url:t,headers:{Authorization:"Bearer "+a},timeout:3e4}).then((function(e){n&&n(e.data)})).catch((function(e){o.handleApiError(e,t)}))},getCurrentPlaybackState:function(e,t){var a=this;C()({method:"GET",url:"https://api.spotify.com/v1/me/player/",headers:{Authorization:"Bearer "+e},timeout:3e4}).then((function(e){t&&t(e.data)})).catch((function(e){a.handleApiError(e)}))},pause:function(e){this.makeApiRequest("PUT","https://genify-proxy.herokuapp.com/https://api.spotify.com/v1/me/player/pause",e)},play:function(e){this.makeApiRequest("PUT","https://genify-proxy.herokuapp.com/https://api.spotify.com/v1/me/player/play",e)},previousTrack:function(e){this.makeApiRequest("POST","https://genify-proxy.herokuapp.com/https://api.spotify.com/v1/me/player/previous",e)},nextTrack:function(e){this.makeApiRequest("POST","https://genify-proxy.herokuapp.com/https://api.spotify.com/v1/me/player/next",e)},setVolume:function(e,t){var a=S+"https://api.spotify.com/v1/me/player/volume";a+="?volume_percent="+t,this.makeApiRequest("PUT",a,e)},seek:function(e,t){var a=S+"https://api.spotify.com/v1/me/player/seek";a+="?position_ms="+t,this.makeApiRequest("PUT",a,e)}},O=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,null,[{key:"setCookie",value:function(e,t,a){var n=new Date;n.setTime(n.getTime()+24*a*60*60*1e3);var o="expires="+n.toUTCString();document.cookie=e+"="+t+";"+o+";path=/;"}},{key:"getCookie",value:function(e){for(var t=e+"=",a=document.cookie.split(";"),n=0;n<a.length;n++){for(var o=a[n];" "===o.charAt(0);)o=o.substring(1);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return null}},{key:"deleteCookie",value:function(e){for(var t=document.cookie.split(";"),a=-1,n=0;n<t.length;n++){for(var o=t[n];" "===o.charAt(0);)o=o.substring(1);0===o.indexOf(e)&&(a=n)}t.splice(a,1),document.cookie=t.join(";")}},{key:"checkCookie",value:function(t){return""!==e.getCookie(t)}}]),e}(),L="spotify-auth";a(332);var R=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(s.a)(this,a),n=t.call(this,e);var o=new URLSearchParams(n.props.location.search).get("auth");return n.state={authStatus:o,showAuthError:null!==o,redirect:null},n.onGetSpotifyAuth=n.onGetSpotifyAuth.bind(Object(d.a)(n)),n}return Object(l.a)(a,[{key:"onGetSpotifyAuth",value:function(){var e=O.getCookie(L),t=JSON.parse(e);if(null!==t&&t.refreshToken)this.setState({redirect:"/app"});else{var a=A.getPKCEAuthUri();window.location=a}}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"text-center genify-home splash-gradiant text-white"},o.a.createElement(p.a,{className:"h-100 mx-0"},o.a.createElement(f.a,{className:"my-auto"},o.a.createElement("h1",{style:{fontSize:"3rem",fontWeight:"300"}},"Genify"),o.a.createElement("h4",{style:{fontWeight:"300"},className:"py-2"},"Combining music, lyrics and video"),o.a.createElement(g.a,{className:"spotify-background py-2 px-5",style:{fontSize:"1.25rem",width:"250px"},onClick:this.onGetSpotifyAuth},o.a.createElement(v.a,{icon:b.b,className:"mr-2"}),"Sign In"),o.a.createElement("div",{className:"mx-auto mt-3"},o.a.createElement("a",{href:"https://joshlmao.com",className:"my-auto mr-2 text-white"},"JoshLmao"),o.a.createElement("a",{href:"https://twitter.com/joshlmao"},o.a.createElement(g.a,{className:"py-0 px-2",variant:"outline-light"},o.a.createElement(v.a,{icon:b.c})))))),this.state.authStatus&&o.a.createElement(y.a,{show:this.state.showAuthError,onClose:function(){return e.setState({showAuthError:!1})},className:"mr-2 mb-2 text-left",style:{position:"absolute",bottom:0,right:0,color:"black"}},o.a.createElement(y.a.Header,null,o.a.createElement("strong",{className:"mr-auto"},"A Problem Occured")),o.a.createElement(y.a.Body,null,function(e){switch(e){case"invalid":return"A problem has occured trying to get the user auth. Please try again";case"expired":return"User's authorization has expired. Please sign in again";case"refresh_error":return"An error occured when attempting to refresh the previous Spotify auth. Please sign in again";default:return"Unknown error"}}(this.state.authStatus))),this.state.redirect&&o.a.createElement(m.a,{to:this.state.redirect}))}}]),a}(n.Component),_=a(447),U=a(445),z=a(443),D=a(198),I=a.n(D),M=a(199),F=a(413),B=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).state={displayChangelog:!1},n.toggleChangelog=n.toggleChangelog.bind(Object(d.a)(n)),n}return Object(l.a)(a,[{key:"toggleChangelog",value:function(){this.setState({displayChangelog:!this.state.displayChangelog})}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"genify-navbar"},o.a.createElement(_.a,{expand:"sm",style:{backgroundColor:"#111111"}},o.a.createElement(f.a,null,o.a.createElement(_.a.Brand,{href:"/",className:"text-white"},"Genify"),o.a.createElement(U.a.Link,{className:"p-0 align-bottom mt-1",style:{fontSize:"0.85rem"},href:"",onClick:this.toggleChangelog},F?"v"+F.version:"v0.0.0"),o.a.createElement(_.a.Toggle,{"aria-controls":"basic-navbar-nav"}),o.a.createElement(_.a.Collapse,{id:"basic-navbar-nav"},o.a.createElement(U.a,{className:"ml-auto"},o.a.createElement(U.a.Link,{className:"py-0",href:"https://github.com/JoshLmao/Genify"},o.a.createElement(g.a,{variant:"outline-secondary"},o.a.createElement(v.a,{icon:b.a}))),o.a.createElement(U.a.Link,{className:"py-0",href:"https://twitter.com/JoshLmao"},o.a.createElement(g.a,{variant:"outline-secondary"},o.a.createElement(v.a,{icon:b.c}))))))),this.state.displayChangelog&&o.a.createElement(z.a,{size:"lg",show:this.state.displayChangelog,onHide:function(){return e.toggleChangelog()}},o.a.createElement(z.a.Header,{closeButton:!0,style:{backgroundColor:"#111",borderColor:"#222"}},o.a.createElement(z.a.Title,{id:"example-modal-sizes-title-lg"},"Changelog")),o.a.createElement(z.a.Body,{style:{backgroundColor:"#111",borderColor:"#222",fontSize:"0.85rem"}},M.logs.map((function(e){return o.a.createElement("div",null,o.a.createElement("h3",null,e.version),o.a.createElement("ul",null,e.changes.map((function(e){return o.a.createElement("li",null,o.a.createElement(I.a,{source:e,className:"no-child-margins"}))}))))}))),o.a.createElement(z.a.Footer,{style:{backgroundColor:"#111",borderColor:"#222"}},o.a.createElement(g.a,{variant:"outline-light",className:"ml-auto",onClick:function(){e.toggleChangelog(),console.log("updating")}},"Close"))))}}]),a}(n.Component),G=a(21),V=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).state={redirect:""},n.onReturn=n.onReturn.bind(Object(d.a)(n)),n}return Object(l.a)(a,[{key:"onReturn",value:function(){this.setState({redirect:"/"})}},{key:"render",value:function(){return o.a.createElement(p.a,{className:"w-100 spotify-black genify-home px-0"},o.a.createElement(f.a,{className:"pt-5"},o.a.createElement("h2",{className:"text-center pt-5"},"Error 404: Page Not Found"),o.a.createElement("h6",{className:"text-center"},"\u4f60\u8ff7\u8def\u4e86\u5417\uff1f"),o.a.createElement("div",{className:"py-3"}),o.a.createElement("h5",{className:"mx-auto"},"This page can't be found. Are you sure you typed it in correctly?"),o.a.createElement("div",{className:"mx-auto"},o.a.createElement(g.a,{className:"mx-auto",onClick:this.onReturn,variant:"outline-light"},o.a.createElement(v.a,{icon:G.a,className:"mr-2"}),"Click here to get right back to the music"))),this.state.redirect&&o.a.createElement(m.a,{to:this.state.redirect},"here"))}}]),a}(n.Component),q=a(205),J=a(117),H=a.n(J);function K(e){var t=(e/1e3).toFixed(0),a=Math.floor(t/60),n="";return a>59&&(a=(a-=60*(n=(n=Math.floor(a/60))>=10?n:"0"+n))>=10?a:"0"+a),t=(t=Math.floor(t%60))>=10?t:"0"+t,""!==n?n+":"+a+":"+t:a+":"+t}function W(e){var t="https://via.placeholder.com/75";e&&(e.item.album&&e.item.album.images.length>0&&(t=e.item.album.images[0].url));return t}var X=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n,o;return Object(s.a)(this,a),(o=t.call(this,e)).state={auth:e.auth,playState:e.playState,volumePercent:e.playState?null===(n=e.playState.device)||void 0===n?void 0:n.volume_percent:0,trackProgressMs:e.playState?e.playState.progress_ms:0,isChangingTrackProgress:!1},o.onPlayPause=o.onPlayPause.bind(Object(d.a)(o)),o.onNextTrack=o.onNextTrack.bind(Object(d.a)(o)),o.onPreviousTrack=o.onPreviousTrack.bind(Object(d.a)(o)),o.onToggleVolumeMute=o.onToggleVolumeMute.bind(Object(d.a)(o)),o.onVolumeChanged=o.onVolumeChanged.bind(Object(d.a)(o)),o.onFinishVolumeChanged=o.onFinishVolumeChanged.bind(Object(d.a)(o)),o.onProgressChanged=o.onProgressChanged.bind(Object(d.a)(o)),o.onFinishProgressChanged=o.onFinishProgressChanged.bind(Object(d.a)(o)),o}return Object(l.a)(a,[{key:"componentDidUpdate",value:function(e){var t,a,n;e.playState!==this.props.playState&&this.setState({playState:this.props.playState,volumePercent:null===(t=this.props.playState)||void 0===t||null===(a=t.device)||void 0===a?void 0:a.volume_percent,trackProgressMs:null===(n=this.props.playState)||void 0===n?void 0:n.progress_ms});e.auth!==this.props.auth&&(this.setState({auth:this.props.auth}),console.log("Player Auth recieved update"))}},{key:"onPlayPause",value:function(){this.state.playState&&(this.state.playState.is_playing?A.pause(this.state.auth.authToken):A.play(this.state.auth.authToken))}},{key:"onNextTrack",value:function(){A.nextTrack(this.state.auth.authToken)}},{key:"onPreviousTrack",value:function(){A.previousTrack(this.state.auth.authToken)}},{key:"onToggleVolumeMute",value:function(){var e;this.state.playState&&((null===(e=this.state.playState.device)||void 0===e?void 0:e.volume_percent)>0?A.setVolume(this.state.auth.authToken,0):A.setVolume(this.state.auth.authToken,25))}},{key:"onVolumeChanged",value:function(e){this.setState({volumePercent:parseInt(e.target.value)})}},{key:"onFinishVolumeChanged",value:function(){var e;this.state.volumePercent!==(null===(e=this.state.playState.device)||void 0===e?void 0:e.volume_percent)&&(console.log("Web API: Set volume to "+this.state.volumePercent),A.setVolume(this.state.auth.authToken,this.state.volumePercent))}},{key:"onProgressChanged",value:function(e){this.setState({trackProgressMs:parseInt(e.target.value)}),this.state.isChangingTrackProgress||this.setState({isChangingTrackProgress:!0})}},{key:"onFinishProgressChanged",value:function(){this.state.playState&&this.state.playState.progress_ms!==this.state.trackProgressMs&&A.seek(this.state.auth.authToken,this.state.trackProgressMs),this.setState({isChangingTrackProgress:!1})}},{key:"render",value:function(){var e,t,a,n,r,i,s,l,c,u;return o.a.createElement(p.a,{className:"w-100 mx-0 genify-player",style:{backgroundColor:"rgb(40,40,40)"}},o.a.createElement(q.a,{xl:3,lg:3,md:4,sm:5,xs:12},o.a.createElement("div",{className:"d-flex align-items-center my-auto"},this.state.playState&&o.a.createElement("a",{href:this.state.playState?null===(e=this.state.playState.item)||void 0===e||null===(t=e.album)||void 0===t||null===(a=t.external_urls)||void 0===a?void 0:a.spotify:"#",className:"ml-2 p-2"},o.a.createElement("img",{className:"album-art",alt:this.state.playState?(null===(n=this.state.playState.item)||void 0===n?void 0:n.artists[0].name)+"Album Art":"Unknown Album",src:W(this.state.playState),style:{maxWidth:"75px",maxHeight:"75px"}})),o.a.createElement("div",{className:"w-100 ml-2"},o.a.createElement("a",{href:this.state.playState?null===(r=this.state.playState.item)||void 0===r||null===(i=r.external_urls)||void 0===i?void 0:i.spotify:"#"},o.a.createElement("h6",{className:"song-info"},this.state.playState?null===(s=this.state.playState.item)||void 0===s?void 0:s.name:"")),o.a.createElement("h6",{className:"song-info"},this.state.playState?function(e){var t;if(!e)return null;var a=null===(t=e.item)||void 0===t?void 0:t.artists;return a?o.a.createElement("div",{className:"d-flex"},a.map((function(e,t){return o.a.createElement("div",{className:"d-flex",key:e.name},o.a.createElement("a",{href:e.external_urls.spotify},e.name),t<a.length-1&&o.a.createElement("div",{className:"pr-1"}," ,"))}))):null}(this.state.playState):""))),!this.state.playState&&o.a.createElement("div",{className:"my-auto"},o.a.createElement("h6",null,"No song currently playing."),o.a.createElement("h6",null,"Play a song to get started!"))),o.a.createElement(q.a,{xl:6,lg:6,md:5,sm:7,className:"d-none d-sm-block my-auto"},o.a.createElement("div",{className:"d-flex align-items-center my-1"},o.a.createElement("div",{className:"mx-auto my-1"},o.a.createElement(g.a,{className:"mx-2",variant:"outline-light",onClick:this.onPreviousTrack},o.a.createElement(v.a,{icon:G.e})),o.a.createElement(g.a,{className:"mx-2",variant:"outline-light",onClick:this.onPlayPause},o.a.createElement(v.a,{icon:(null===(l=this.state.playState)||void 0===l?void 0:l.is_playing)?G.b:G.c})),o.a.createElement(g.a,{className:"mx-2",variant:"outline-light",onClick:this.onNextTrack},o.a.createElement(v.a,{icon:G.f})))),o.a.createElement("div",{className:"d-flex align-items-center my-1"},o.a.createElement("h6",{className:"my-auto mx-2"},this.state.playState&&K(this.state.isChangingTrackProgress?this.state.trackProgressMs:this.state.playState.progress_ms),!this.state.playState&&"0:00"),o.a.createElement("div",{className:"w-100",onMouseUp:this.onFinishProgressChanged},o.a.createElement(H.a,{value:this.state.trackProgressMs,min:0,max:this.state.playState?null===(c=this.state.playState.item)||void 0===c?void 0:c.duration_ms:100,onChange:this.onProgressChanged,tooltip:"off"})),o.a.createElement("h6",{className:"my-auto mx-2"},this.state.playState&&K(null===(u=this.state.playState.item)||void 0===u?void 0:u.duration_ms),!this.state.playState&&"9:59"))),o.a.createElement(q.a,{xl:3,lg:3,md:3,className:"d-none d-md-block my-auto"},o.a.createElement("div",{className:"d-flex align-items-center"},o.a.createElement(g.a,{className:"mx-2",variant:"outline-light",onClick:this.onToggleVolumeMute},o.a.createElement(v.a,{icon:0===this.state.volumePercent?G.g:G.h})),o.a.createElement("div",{onMouseUp:this.onFinishVolumeChanged,className:"w-100"},o.a.createElement(H.a,{value:this.state.volumePercent,onChange:this.onVolumeChanged,tooltip:"auto",variant:"primary"})))))}}]),a}(n.Component),Y=a(444),Z="none",$="english",Q="simplified-chinese",ee="traditional-chinese",te="korean",ae="japanese",ne="russian";var oe=a(209),re=a(206),ie=a(118),se=a.n(ie),le=a(207),ce=a.n(le),ue=a(208),he=a.n(ue),me=a(66);function de(e){return e.replace(/^\s+|\s+$/g,"")}function pe(e){return(e=function(e){return e.replace(/[^\w\s]/gi,"")}(e=function(e){return e.replace(/\s/g," ")}(e))).toLowerCase()}var fe={search:function(e,t){if(!e)return null;var a=e.item.name.replace(/ *\([^)]*\) */g,""),n=encodeURIComponent("".concat(a," ").concat(e.item.artists[0].name)),o=S+"https://api.genius.com/search?q="+n;C()({method:"GET",url:o,headers:{Authorization:"Bearer "+E},timeout:3e4}).then((function(e){t&&t(e.data)})).catch((function(e){console.error(e)}))},parseLyricsFromUrl:function(e,t){var a=S+e+"?react=1";C()({method:"GET",url:a,headers:{Authorization:"Bearer "+E},timeout:3e4}).then((function(e){if(t){var n="",o=function(e){var t=document.implementation.createHTMLDocument();return t.body.innerHTML=e,t.body}(e.request.responseText);if(o.querySelectorAll(".lyrics").length<=0){var r,i=o.getElementsByTagName("div"),s=Object(me.a)(i);try{for(s.s();!(r=s.n()).done;){var l=r.value,c=l.className.toLowerCase();if(c.includes("lyric")&&c.includes("container"))n+=l.innerHTML.replace(/<br>/g,"\n").replace(/<[^>]*>?/gm,"")}}catch(d){s.e(d)}finally{s.f()}if(n){var u=de(n);t(u)}else console.error("Unable to parse lyrics correctly from page ".concat(a))}else{var h=o.querySelectorAll(".lyrics");if(h.length>0){var m=de(h[0].textContent);t(m)}else console.error("Unable to parse lyrics from old Genius layout")}}})).catch((function(e){console.error(e)}))},getRelevantResult:function(e,t){if(t){if(!(e&&e.length>0))return null;var a,n=Object(me.a)(e);try{for(n.s();!(a=n.n()).done;){var o=a.value,r=pe(o.result.primary_artist.name),i=pe(o.result.title),s=pe(t.name),l=pe(t.artists[0].name),c=r.includes(l)&&i.includes(s),u=l.includes(r)&&s.includes(i);if(c||u)return o}}catch(h){n.e(h)}finally{n.f()}}}},ge=(a(434),function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(s.a)(this,a),n=t.call(this,e);var o=new oe.a;return o.init(new re.a({dictPath:"./dict"})),n.state={playState:e.playState,originalLyrics:null,romanizedLyrics:null,lyricsSpotifyTrackName:null,lyricsInfo:null,loaded:!0,isRomanized:!1,originalLyricLanguage:Z,kuroshiro:o,shouldUpdateLyrics:!0},n.updateLyrics=n.updateLyrics.bind(Object(d.a)(n)),n.onToggleRomanize=n.onToggleRomanize.bind(Object(d.a)(n)),n.resetLyricState=n.resetLyricState.bind(Object(d.a)(n)),n.onRetryLyricsBtn=n.onRetryLyricsBtn.bind(Object(d.a)(n)),n}return Object(l.a)(a,[{key:"componentDidUpdate",value:function(e){var t=this;e.playState!==this.props.playState&&this.setState({playState:this.props.playState},(function(){var a,n,o;null!==e.playState&&(null===(a=e.playState)||void 0===a||null===(n=a.item)||void 0===n?void 0:n.name)===(null===(o=t.props.playState.item)||void 0===o?void 0:o.name)||t.updateLyrics()}))}},{key:"updateLyrics",value:function(){var e=this;this.state.playState&&this.state.loaded&&(this.setState({loaded:!1,shouldUpdateLyrics:!1,lyricsSpotifyTrackName:null}),fe.search(this.state.playState,(function(t){if(t.response.hits.length>0){var a=fe.getRelevantResult(t.response.hits,e.state.playState.item);a?(console.log("Relevant Result: ".concat(a.result.full_title)),fe.parseLyricsFromUrl(a.result.url,(function(t){console.log("Loaded and set lyrics from ".concat(a.result.url));var n=function(e){var t=Z,a=function(e){return e.match(/[\uac00-\ud7af]|[\u1100-\u11ff]|[\u3130-\u318f]|[\ua960-\ua97f]|[\ud7b0-\ud7ff]/g)}(e);null!==a&&(t=te);var n=function(e){return e.match(/[\u3041-\u3093\u30a1-\u30f3]/g)}(e),o=function(e){return e.match(/[\u2E80-\u2FD5\u3190-\u319f\u3400-\u4DBF\u4E00-\u9FCC\uF900-\uFAAD]/g)}(e);null!==n&&null!==o?t=n.length>o.length?ae:Q:null!==n?t=ae:null!==o&&(t="chinese");var r=function(e){return e.match(/^[\u0430\u0410\u0431\u0411\u0432\u0412\u0433\u0413\u0434\u0414\u0435\u0415\u0451\u0401\u0436\u0416\u0437\u0417\u0438\u0418\u0439\u0419\u043a\u041a\u043b\u041b\u043c\u041c\u043d\u041d\u043e\u041e\u043f\u041f\u0440\u0420\u0441\u0421\u0442\u0422\u0443\u0423\u0444\u0424\u0445\u0425\u0446\u0426\u0447\u0427\u0448\u0428\u0449\u0429\u044a\u042a\u044b\u042b\u044c\u042c\u044d\u042d\u044e\u042e\u044f\u042f]+$/)}(e);return null!==r&&(t=ne),"chinese"===t&&(t=Q),null==a&&null==n&&null==o&&null==r&&(t=$),t}(t);console.log("Original lyrics language: '".concat(n,"'")),e.setState({originalLyrics:t,romanizedLyrics:t,isRomanized:!1,originalLyricLanguage:n,lyricsInfo:a,loaded:!0,lyricsSpotifyTrackName:e.state.playState.item})}))):(console.log("No related lyrics found out of '".concat(t.response.hits.length,"' results for song '").concat(e.state.playState.item.artists[0].name," - ").concat(e.state.playState.item.name,"'")),e.setState({loaded:!0}),e.resetLyricState())}else console.log("Didn't find any search results on Genius"),e.setState({loaded:!0}),e.resetLyricState()})))}},{key:"resetLyricState",value:function(){this.setState({originalLyrics:null,romanizedLyrics:null,lyricsInfo:null,isRomanized:!1,originalLyricLanguage:Z})}},{key:"onToggleRomanize",value:function(){var e=this;if(this.state.originalLyrics){if(this.state.isRomanized)this.setState({romanizedLyrics:this.state.originalLyrics});else{var t="";switch(this.state.originalLyricLanguage){case ae:if(!this.state.kuroshiro)break;t="...",this.state.kuroshiro.convert(this.state.originalLyrics,{to:"romaji",mode:"spaced"}).then((function(t){t=t.replace(/ +(?= )/g,""),e.setState({romanizedLyrics:t})}));break;case Q:case ee:t=se.a.convertToPinyinString(this.state.originalLyrics," ",se.a.WITH_TONE_MARK);break;case te:t=ce.a.romanize(this.state.originalLyrics);break;case ne:t=he()().transform(this.state.originalLyrics," ")}this.setState({romanizedLyrics:t})}this.setState({isRomanized:!this.state.isRomanized})}}},{key:"onRetryLyricsBtn",value:function(){var e=this;this.state.shouldUpdateLyrics||(this.setState({shouldUpdateLyrics:!0},(function(){return e.updateLyrics()})),console.log("Retrying lyrics at request of user"))}},{key:"render",value:function(){return o.a.createElement("div",{className:"w-100 lyrics-container py-2"},o.a.createElement("div",{className:"text-center h-100"},!this.state.loaded&&o.a.createElement(v.a,{className:"fa-spin",size:"3x",icon:G.d}),this.state.romanizedLyrics&&this.state.loaded&&o.a.createElement("div",{className:"h-100"},o.a.createElement("div",{className:"pr-5 mb-2 text-right d-none d-sm-block",style:{height:"35px",position:"absolute",right:0,fontSize:"0.8rem"}},o.a.createElement("h6",{className:"mb-1"},"Lyric Info"),o.a.createElement("a",{href:this.state.lyricsInfo.result.url,className:"py-1"},this.state.lyricsInfo.result.full_title),this.state.originalLyricLanguage!==$&&o.a.createElement(Y.a,null,o.a.createElement(Y.a.Check,{type:"switch",id:"custom-switch",label:"Romanize",onChange:this.onToggleRomanize}))),o.a.createElement("div",{className:"lyrics-content"},this.state.romanizedLyrics)),!this.state.originalLyrics&&this.state.loaded&&o.a.createElement("div",{className:"d-flex flex-column"},o.a.createElement("a",{href:"https://genius.com/new"},o.a.createElement(g.a,{variant:"outline-light",className:"mt-2"},"Add to Genius")),o.a.createElement(g.a,{className:"mx-auto my-2",variant:"outline-light",onClick:this.onRetryLyricsBtn},"Retry Lyrics"))))}}]),a}(n.Component)),ye=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(s.a)(this,a),n=t.call(this,e);var o="",r=O.getCookie(L),i=JSON.parse(r),l=!1;return null===i?(o="/?auth=invalid",console.log("No or auth found in cookies, going home")):(i.expireDate=new Date(i.expireDate),i.expireDate<Date.now()?i.refreshToken?(console.log("Auth expired at '".concat(i.expireDate.toLocaleString(),"'. Using refreshToken to get new auth'")),l=!0,n.refreshAuth(i.refreshToken)):(O.deleteCookie(L),o="/?auth=expired",console.log("Auth found but has expired")):console.log("Auth found. Expires at '".concat(i.expireDate.toLocaleString(),"'"))),n.state={auth:i,isRefreshingAuth:l,refreshAuthRoutine:null,spotifyUpdateRoutine:null,infoMessage:"",showInfoMessage:!1,redirect:o},n.initService=n.initService.bind(Object(d.a)(n)),n.refreshAuth=n.refreshAuth.bind(Object(d.a)(n)),n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){null!==this.state.auth||this.state.isRefreshingAuth||this.setState({redirect:"/?auth=invalid"}),null===this.state.auth||this.state.isRefreshingAuth||this.initService()}},{key:"initService",value:function(){var e=this;if(A.getCurrentPlaybackState(this.state.auth.authToken,(function(t){e.setState({playState:t,loaded:!0})})),!this.state.spotifyUpdateRoutine){var t=setInterval((function(){var t;null===(t=e.state.auth)||null!=t&&t.expireDate<Date.now()||A.getCurrentPlaybackState(e.state.auth.authToken,(function(t){var a,n,o;(null===(a=t.item)||void 0===a?void 0:a.name)!==(null===(n=e.state.playState.item)||void 0===n?void 0:n.name)&&console.log("TRACK CHANGED | ".concat(t.item.artists[0].name," - ").concat(null===(o=t.item)||void 0===o?void 0:o.name));e.setState({playState:t})}))}),2e3);this.setState({updateRoutine:t})}if(!this.state.refreshAuthRoutine){var a=this.state.auth.expireDate-new Date(Date.now()),n=setTimeout((function(){console.log("Auth will expire in ".concat(3," minute(s). Refreshing...")),e.setState({refreshAuthRoutine:null}),e.refreshAuth(e.state.auth.refreshToken)}),a-18e4);this.setState({refreshAuthRoutine:n})}}},{key:"refreshAuth",value:function(e){var t=this;this.setState({isRefreshingAuth:!0}),A.refreshAuth(e,(function(e){var a=A.parseAuth(e);if(a){console.log("Successfully refreshed auth. Expires at '".concat(a.expireDate.toLocaleString(),"'"));var n=JSON.stringify(a);O.setCookie(L,n)}else console.error("Error when trying to refresh auth"),O.deleteCookie(L),t.setState({redirect:"/?auth=refresh_error"});t.setState({isRefreshingAuth:!1,auth:a},(function(){t.initService()}))}))}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"genify-home spotify-black"},o.a.createElement(p.a,{className:"mx-0"},o.a.createElement(X,{playState:this.state.playState,auth:this.state.auth})),o.a.createElement(ge,{playState:this.state.playState}),this.state.infoMessage&&o.a.createElement(y.a,{show:this.state.showInfoMessage,onClose:function(){return e.setState({showInfoMessage:!1})},className:"mr-2 mb-2 text-left",style:{position:"absolute",bottom:0,right:0,color:"black"}},o.a.createElement(y.a.Header,null,o.a.createElement("strong",{className:"mr-auto"},"Info")),o.a.createElement(y.a.Body,null,this.state.infoMessage)),this.state.redirect&&o.a.createElement(m.a,{to:this.state.redirect}))}}]),a}(n.Component),ve=(a(435),a(436),function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n,o;Object(s.a)(this,a),o=t.call(this,e);var r={};if(null===(n=e.location)||void 0===n?void 0:n.search){var i=e.location.search.substring(1).split("&");if(i.length<=2){var l,c=Object(me.a)(i);try{for(c.s();!(l=c.n()).done;){var u=l.value,h=u.split("=");u.includes("code")?r.code=h[1]:u.includes("state")?r.state=h[1]:u.includes("error")&&(r.error=h[1])}}catch(m){c.e(m)}finally{c.f()}}}return o.state={exchangeData:r},o}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.state.exchangeData&&A.exchangePKCECode(this.state.exchangeData.code,(function(t){var a=A.parseAuth(t);if(a){var n=JSON.stringify(a);O.setCookie(L,n),console.log("Successfully saved auth! Redirecting..."),setTimeout((function(){e.setState({redirect:"/app"})}),100)}else console.error("Unable to parse and save auth")}))}},{key:"render",value:function(){return o.a.createElement("div",{className:"h-100 w-100 spotify-black"},o.a.createElement("h3",{className:"text-center pt-5"},"Redirecting..."),o.a.createElement("div",{className:"mx-auto",style:{width:"50px"}},o.a.createElement(v.a,{className:"fa-spin",size:"3x",icon:G.d})),this.state.redirect&&o.a.createElement(m.a,{to:this.state.redirect}))}}]),a}(n.Component)),be=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return o.a.createElement(h.a,{basename:""},o.a.createElement(B,null),o.a.createElement(m.d,null,o.a.createElement(m.b,{exact:!0,path:"/",component:R}),o.a.createElement(m.b,{exact:!0,path:"/app",component:ye}),o.a.createElement(m.b,{exact:!0,path:"/callback",component:ve}),o.a.createElement(m.b,{component:V})))}}]),a}(n.Component),ke=(a(437),o.a.createElement(o.a.StrictMode,null,o.a.createElement(be,null)));i.a.render(ke,document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[210,1,2]]]);
//# sourceMappingURL=main.763990e6.chunk.js.map