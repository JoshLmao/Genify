(this.webpackJsonpgenify=this.webpackJsonpgenify||[]).push([[0],{213:function(e){e.exports=JSON.parse('{"logs":[{"version":"3.0.10","dateISO":"2021-07-15T11:01:20.417Z","changes":["Implemented keyboard shortcuts for Spotify player, space to Play/Pause, left/right to rewind/fast-forward, credit to [#15](https://github.com/JoshLmao/Genify/issues/15)","Fixed lyric sections sometimes not being separated correctly, related to [#17](https://github.com/JoshLmao/Genify/issues/17)"]},{"version":"3.0.9","dateISO":"2021-04-09T16:46:32.511Z","changes":["Further improvements to searching Genius for songs with \'Live\' or \'Radio Edit\', related to [#14](https://github.com/JoshLmao/Genify/issues/14)","Able to convert between simplified and traditional chinese through switch","Option in settings to automatically convert between simplified and traditional"]},{"version":"3.0.8","dateISO":"2021-04-08T09:13:13.433Z","changes":["Added font size to settings. Able to change scale of lyrics text from x1 to x2","Improved Genius searching for song that contain \'remix\', related to [#14](https://github.com/JoshLmao/Genify/issues/14)"]},{"version":"3.0.7","changes":["Top or recent user tracks get suggested if user isn\'t listening to a track","Improved support for if the user denies authorization during Spotify auth stage","Made some fancy controls in the style of Genify \ud83d\ude0a","Fixed issue [#11](https://github.com/JoshLmao/Genify/issues/11) of verses in lyrics not being separated and having \'&amp;\' instead of \'&\'","Fixed issue [#12](https://github.com/JoshLmao/Genify/issues/12) where lyrics would never load"]},{"version":"3.0.6","changes":["You can now set and save app options under the settings tab","Can enable automatic romanization of lyrics in settings to automatically romanize when new lyrics appear, if they aren\'t already"]},{"version":"3.0.5","changes":["(Re)fixed issue [#10](https://github.com/JoshLmao/Genify/issues/10) to allow cookies to stay after browser is closed"]},{"version":"3.0.4","changes":["Added navigation bar below player for changing focused content","Added settings page with information on signed in user","Can sign out of app to remove authorization","Can change and set the current playback device of Spotify"]},{"version":"3.0.3","changes":["Updated icon and added for mobile devices","Fixed issue [#7](https://github.com/JoshLmao/Genify/issues/7) where the white space from Genius was unexpected","Implemented a fix for issue [#8](https://github.com/JoshLmao/Genify/issues/8) causing app to crash and auth to not get updated"]},{"version":"3.0.2","changes":["Implemented new Spotify auth path: [Proof Key for Code Exchange](https://developer.spotify.com/documentation/general/guides/authorization-guide/#authorization-code-flow-with-proof-key-for-code-exchange-pkce)","Lyrics only get updated when track change"]},{"version":"3.0.1","changes":["Fixed the app using expired auth causing no access"]},{"version":"3.0.0: The React Update \ud83c\udf89","changes":["Changed site to use React","Site speed improved by a lot","Removed Youtube video player and options (for now)","Removed ability to change Spotify playback device (for now)","Improved overall app flow for getting user authorization","Added information about current Genius lyrics","Able to detect and romanize Russian lyrics","Can set the current playback time of the current Spotify track","User can set volume of current playback device","Can view and navigate to all artists on current track"]}]}')},224:function(e,t,a){e.exports=a(454)},253:function(e,t){},255:function(e,t){},266:function(e,t){},268:function(e,t){},293:function(e,t){},295:function(e,t){},296:function(e,t){},302:function(e,t){},304:function(e,t){},322:function(e,t){},325:function(e,t){},341:function(e,t){},344:function(e,t){},347:function(e,t,a){},428:function(e){e.exports=JSON.parse('{"name":"genify","version":"3.0.10","homepage":"https://genify.joshlmao.com","private":true,"dependencies":{"@fortawesome/fontawesome-svg-core":"^1.2.29","@fortawesome/free-brands-svg-icons":"^5.13.1","@fortawesome/free-solid-svg-icons":"^5.13.1","@fortawesome/react-fontawesome":"^0.1.11","@testing-library/jest-dom":"^4.2.4","@testing-library/react":"^9.5.0","@testing-library/user-event":"^7.2.1","aromanize":"^0.1.5","axios":"^0.21.1","bootstrap":"^4.5.0","crypto-js":"^4.0.0","cyrillic-to-translit-js":"^3.1.0","js-cookie":"^2.2.1","kuroshiro":"^1.1.2","kuroshiro-analyzer-kuromoji":"^1.1.0","pinyin4js":"^1.3.18","react":"^16.13.1","react-bootstrap":"^1.1.1","react-bootstrap-range-slider":"^1.0.0","react-dom":"^16.13.1","react-hot-keys":"^2.6.2","react-markdown":"^4.3.1","react-router-dom":"^5.2.0","react-scripts":"3.4.1","traditional-or-simplified-modified":"^2.0.1"},"scripts":{"predeploy":"npm run build","deploy":"gh-pages -d build -m \\"Updated live build to the latest changes\\"","start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject"},"eslintConfig":{"extends":"react-app"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"gh-pages":"^3.1.0"}}')},449:function(e,t,a){},453:function(e,t,a){},454:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),s=a(29),o=a.n(s);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var r=a(11),l=a(12),c=a(14),u=a(13),h=a(50),m=a(15),d=a(6),p=a(459),g=a(460),v=a(461),f=a(466),y=a(10),k=a(37),S=a(20),b=a.n(S),E="dZ7Y5s8PMg_oljOH1DgF_PDXXp-GvzF3g1OMlXh08Af~5J5hosQPQ4eNILnSf3IK.SKtnWlgANdHC.1.wSBw0ZqxtxBRsD7vkGV_f67RBa4DoFo0O3mrz5wB-3e17TsK",x="jZPEvjdl6Sk1RJUDoo0tTuEFYv2B8rbosLsOUnFBqbi11dCtfftjiN911-a9q0lo",C="https://genify-proxy.herokuapp.com/";var T=a(42),N=a.n(T),w=a(209),P=a.n(w),O=a(210),j=a.n(O),R=a(9);function D(e){var t=[];for(var a in e){var n=encodeURIComponent(a),i=encodeURIComponent(e[a]);t.push(n+"="+i)}return t=t.join("&")}function A(e){switch(e.toLowerCase()){case"tv":return R.o;case"computer":return R.f;case"smartphone":return R.g;case"tablet":return R.n;case"gameconsole":return R.c;case"speaker":return R.r;case"automobile":return R.a;default:return R.j}}var L={getRequiredScopes:function(){return["streaming","user-read-currently-playing","user-read-playback-state","user-modify-playback-state","app-remote-control","user-read-email","user-read-private","user-top-read","user-read-recently-played"]},getPKCEAuthUri:function(){var e=encodeURIComponent("https://genify.joshlmao.com/callback"),t=this.getRequiredScopes(),a=encodeURIComponent(t.join(" ")),n=this.encodePKCEChallenge(E),i=n.method,s=n.challenge;return"https://accounts.spotify.com/authorize?"+["response_type=".concat("code"),"client_id=".concat("f4dc97c399124fc99254c5d7ac2bf4bd"),"redirect_uri=".concat(e),"code_challenge=".concat(s),"code_challenge_method=".concat(i),"state=".concat("genify-app"),"scope=".concat(a)].join("&")},encodePKCEChallenge:function(e){var t=P()(e);return{method:"S256",challenge:j.a.stringify(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}},exchangePKCECode:function(e,t){var a=D({grant_type:encodeURIComponent("authorization_code"),client_id:encodeURIComponent("f4dc97c399124fc99254c5d7ac2bf4bd"),code:encodeURIComponent(e),redirect_uri:"https://genify.joshlmao.com/callback",code_verifier:encodeURIComponent(E)});N()({method:"POST",url:"https://accounts.spotify.com/api/token",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},data:a,timeout:3e4}).then((function(e){t&&t(e.data)})).catch((function(e){console.error(e),console.error(e.response.data)}))},parseAuth:function(e){if(!e)return null;var t=e.expires_in,a=this.getAuthExpireTime(t),n=e.scope.split(" ");return{authToken:e.access_token,tokenType:e.token_type,scopes:n,refreshToken:e.refresh_token,expireDate:a}},refreshAuth:function(e,t){var a=this;if(e){var n=D({grant_type:encodeURIComponent("refresh_token"),refresh_token:e,client_id:encodeURIComponent("f4dc97c399124fc99254c5d7ac2bf4bd")});N()({method:"POST",url:"https://accounts.spotify.com/api/token",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},data:n,timeout:3e4}).then((function(e){t&&t(e.data)})).catch((function(e){a.handleApiError(e)}))}return null},handleApiError:function(e,t){var a,n,i,s;console.error("Spotify API Error: '".concat(t,"': '").concat(null!==(a=null===e||void 0===e||null===(n=e.response)||void 0===n||null===(i=n.data)||void 0===i||null===(s=i.error)||void 0===s?void 0:s.message)&&void 0!==a?a:e,"'"))},getAuthExpireTime:function(e){return new Date(Date.now()+1e3*e)},makeApiRequest:function(e,t,a,n){var i=this;N()({method:e,url:t,headers:{Authorization:"Bearer "+a},timeout:3e4}).then((function(e){n&&n(e.data)})).catch((function(e){i.handleApiError(e,t)}))},makeApiDataRequest:function(e,t,a,n,i){var s=this;N()({method:e,url:t,headers:{Authorization:"Bearer "+a},data:n,timeout:3e4}).then((function(e){i&&i(e.data)})).catch((function(e){s.handleApiError(e,t)}))},getCurrentPlaybackState:function(e,t){var a=this,n="https://api.spotify.com/v1/me/player/";N()({method:"GET",url:n,headers:{Authorization:"Bearer "+e},timeout:3e4}).then((function(e){t&&(204===e.status?t(null):t(e.data))})).catch((function(e){a.handleApiError(e,n)}))},pause:function(e){this.makeApiRequest("PUT","https://genify-proxy.herokuapp.com/https://api.spotify.com/v1/me/player/pause",e)},resume:function(e){this.makeApiRequest("PUT","https://genify-proxy.herokuapp.com/https://api.spotify.com/v1/me/player/play",e)},playTrack:function(e,t,a){var n=C+"https://api.spotify.com/v1/me/player/play";t&&(n+="?device_id=".concat(t)),this.makeApiDataRequest("PUT",n,e,{uris:[a]})},playContext:function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=C+"https://api.spotify.com/v1/me/player/play";t&&(s+="?device_id=".concat(t)),this.makeApiDataRequest("PUT",s,e,{context_uri:a,offset:{position:n},position_ms:i})},previousTrack:function(e){this.makeApiRequest("POST","https://genify-proxy.herokuapp.com/https://api.spotify.com/v1/me/player/previous",e)},nextTrack:function(e){this.makeApiRequest("POST","https://genify-proxy.herokuapp.com/https://api.spotify.com/v1/me/player/next",e)},setVolume:function(e,t){var a=C+"https://api.spotify.com/v1/me/player/volume";a+="?volume_percent="+t,this.makeApiRequest("PUT",a,e)},seek:function(e,t){var a=C+"https://api.spotify.com/v1/me/player/seek";a+="?position_ms="+t,this.makeApiRequest("PUT",a,e)},getPlaybackDevices:function(e,t){this.makeApiRequest("GET","https://genify-proxy.herokuapp.com/https://api.spotify.com/v1/me/player/devices",e,t)},setPlaybackDevice:function(e,t,a){var n={device_ids:[t],play:a};this.makeApiDataRequest("PUT","https://genify-proxy.herokuapp.com/https://api.spotify.com/v1/me/player",e,n)},getCurrentUserProfile:function(e,t){this.makeApiRequest("GET","https://genify-proxy.herokuapp.com/https://api.spotify.com/v1/me",e,t)},getUsersTopTracks:function(e,t,a,n){var i=C+"https://api.spotify.com/v1/me/top/tracks?";t>0&&(i+="limit=".concat(t)),a&&(i+="&time_range=".concat(a)),this.makeApiRequest("GET",i,e,n)},getUsersTopArtists:function(e,t,a,n){var i=C+"https://api.spotify.com/v1/me/top/artists?";t>0&&(i+="limit=".concat(t)),a&&(i+="&time_range=".concat(a)),this.makeApiRequest("GET",i,e,n)},getUsersRecentlyPlayed:function(e,t,a){var n=C+"https://api.spotify.com/v1/me/player/recently-played";t&&(n+="?limit=".concat(t)),this.makeApiRequest("GET",n,e,a)}},U="spotify-auth",z="app-settings";a(347);function I(e){var t=null;try{t=JSON.parse(e)}catch(a){console.error("Unable to parse auth cookie")}return t}function _(){var e=b.a.get(z);return e?I(e):null}var M=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(r.a)(this,a),n=t.call(this,e);var i=new URLSearchParams(n.props.location.search).get("auth");return n.state={authStatus:i,showAuthError:null!==i,redirect:null},n.onGetSpotifyAuth=n.onGetSpotifyAuth.bind(Object(d.a)(n)),n}return Object(l.a)(a,[{key:"onGetSpotifyAuth",value:function(){var e=b.a.get(U,{path:""});if(e){var t=I(e);if(null!==t&&t.refreshToken)return void this.setState({redirect:"/app"})}var a=L.getPKCEAuthUri();window.location=a}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"text-center genify-home splash-gradiant text-white"},i.a.createElement(p.a,{className:"h-100 mx-0"},i.a.createElement(g.a,{className:"my-auto"},i.a.createElement("h1",{style:{fontSize:"3rem",fontWeight:"300"}},"Genify"),i.a.createElement("h4",{style:{fontWeight:"300"},className:"py-2"},"Combining music, lyrics and video"),i.a.createElement(v.a,{className:"spotify-background py-2 px-5",style:{fontSize:"1.25rem",width:"250px"},onClick:this.onGetSpotifyAuth},i.a.createElement(y.a,{icon:k.b,className:"mr-2"}),"Sign In"),i.a.createElement("div",{className:"mx-auto mt-3"},i.a.createElement("a",{href:"https://joshlmao.com",className:"my-auto mr-2 text-white"},"JoshLmao"),i.a.createElement("a",{href:"https://twitter.com/joshlmao"},i.a.createElement(v.a,{className:"py-0 px-2",variant:"outline-light"},i.a.createElement(y.a,{icon:k.c})))))),this.state.authStatus&&i.a.createElement(f.a,{show:this.state.showAuthError,onClose:function(){return e.setState({showAuthError:!1})},className:"genify-toast mr-2 mb-2 text-left",style:{position:"absolute",bottom:0,right:0}},i.a.createElement(f.a.Header,null,i.a.createElement("strong",{className:"mr-auto"},"A Problem Occured")),i.a.createElement(f.a.Body,null,function(e){switch(e){case"invalid":return"A problem has occured trying to use a previous authorizatino. Please try again";case"expired":return"User's authorization has expired. Please sign in again";case"refresh_error":return"An error occured when attempting to refresh the previous Spotify authorization. Please sign in again";case"state_error":return"The recieved state doesn't match. If you are trying to manipulate the requests, please dont :)";case"access_denied":return"You have denied access to your authorization. Genify needs your permission to continue. Click 'Sign In' to try again";default:return"Unknown error. Sorry, you shouldn't see this"}}(this.state.authStatus))),this.state.redirect&&i.a.createElement(m.a,{to:this.state.redirect}))}}]),a}(n.Component),F=a(465),G=a(467),q=a(463),J=a(212),B=a.n(J),K=a(213),V=a(428),H=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).state={displayChangelog:!1},n.toggleChangelog=n.toggleChangelog.bind(Object(d.a)(n)),n}return Object(l.a)(a,[{key:"toggleChangelog",value:function(){this.setState({displayChangelog:!this.state.displayChangelog})}},{key:"render",value:function(){var e=this;return i.a.createElement(F.a,{className:"genify-nav-bg",variant:"dark"},i.a.createElement(g.a,null,i.a.createElement(F.a.Brand,{href:"/",className:"text-white"},"Genify"),i.a.createElement(G.a.Link,{className:"p-0 align-bottom mt-1",style:{fontSize:"0.85rem"},href:"",onClick:this.toggleChangelog},V?"v"+V.version:"v0.0.0"),i.a.createElement(F.a.Toggle,{"aria-controls":"basic-navbar-nav",style:{}}),i.a.createElement(F.a.Collapse,{id:"basic-navbar-nav"},i.a.createElement(G.a,{className:"ml-auto"},i.a.createElement(G.a.Link,{className:"py-0",href:"https://github.com/JoshLmao/Genify"},i.a.createElement(v.a,{variant:"outline-secondary"},i.a.createElement(y.a,{icon:k.a}))),i.a.createElement(G.a.Link,{className:"py-0",href:"https://twitter.com/JoshLmao"},i.a.createElement(v.a,{variant:"outline-secondary"},i.a.createElement(y.a,{icon:k.c})))))),this.state.displayChangelog&&i.a.createElement(q.a,{size:"lg",show:this.state.displayChangelog,onHide:function(){return e.toggleChangelog()},className:"changelog-modal"},i.a.createElement(q.a.Header,{closeButton:!0,style:{backgroundColor:"#111",borderColor:"#222"}},i.a.createElement(q.a.Title,{id:"example-modal-sizes-title-lg"},"Changelog")),i.a.createElement(q.a.Body,{className:"changelog-body"},K.logs.map((function(e){return i.a.createElement("div",{key:e.version},i.a.createElement("div",{className:"d-flex"},i.a.createElement("h3",null,e.version),e.dateISO&&i.a.createElement("h6",{className:"ml-2 mb-0 align-self-center"},new Date(e.dateISO).toLocaleDateString())),i.a.createElement("ul",null,e.changes.map((function(t,a){return i.a.createElement("li",{key:e.version+"-"+a},i.a.createElement(B.a,{source:t,className:"no-child-margins"}))}))))}))),i.a.createElement(q.a.Footer,{style:{backgroundColor:"#111",borderColor:"#222"}},i.a.createElement(v.a,{variant:"outline-light",className:"ml-auto",onClick:function(){e.toggleChangelog()}},"Close"))))}}]),a}(n.Component),W=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).state={redirect:""},n.onReturn=n.onReturn.bind(Object(d.a)(n)),n}return Object(l.a)(a,[{key:"onReturn",value:function(){this.setState({redirect:"/"})}},{key:"render",value:function(){return i.a.createElement(p.a,{className:"w-100 spotify-black genify-home px-0"},i.a.createElement(g.a,{className:"pt-5"},i.a.createElement("h2",{className:"text-center pt-5"},"Error 404: Page Not Found"),i.a.createElement("h6",{className:"text-center"},"\u4f60\u8ff7\u8def\u4e86\u5417\uff1f"),i.a.createElement("div",{className:"py-3"}),i.a.createElement("h5",{className:"mx-auto"},"This page can't be found. Are you sure you typed it in correctly?"),i.a.createElement("div",{className:"mx-auto"},i.a.createElement(v.a,{className:"mx-auto",onClick:this.onReturn,variant:"outline-light"},i.a.createElement(y.a,{icon:R.d,className:"mr-2"}),"Click here to get right back to the music"))),this.state.redirect&&i.a.createElement(m.a,{to:this.state.redirect},"here"))}}]),a}(n.Component),Y=a(219),Z=a(464),X=a(222),$=a(216),Q=a(53),ee=a.n(Q),te=a(217),ae=a.n(te),ne=a(218),ie=a.n(ne),se="none",oe="english",re="simplified-chinese",le="traditional-chinese",ce="korean",ue="japanese",he="russian",me=a(99);var de=a(77);function pe(e){return e.replace(/^\s+|\s+$/g,"")}function ge(e){return(e=function(e){return e.replace(/\s/g,"")}(e=function(e){return e.replace(/[^\w\s]/gi,"")}(e=function(e){return e.replace(/\s/g," ")}(e)))).toLowerCase()}function ve(e,t){var a=e.includes("("),n=e.includes(")"),i=e.includes("-"),s="";if(a&&n&&i);else if(a&&n)s=e.match(/\(([^)]+)\)/)[1];else if(i){var o=e.split(" - "),r=o.findIndex((function(e){return e.includes(t)}));r>=0&&(s=o[r])}return s}var fe={search:function(e,t){if(!e)return null;var a=e.item.name,n=function(e,t){var a=(t=t.toLowerCase()).includes("remix"),n=t.includes("live"),i=t.includes("radio edit"),s=t.includes("remaster"),o="",r="",l="";return a&&(o=ve(t,"remix")),n&&(r=ve(t,"live")),(t.includes(" ver")||t.includes("version"))&&(l=ve(t,"ver")),{isRemix:a,isLive:n,isRadioEdit:i,isRemaster:s,remixCreator:o,liveLocation:r,versionName:l}}(0,a);a.includes("-")&&(a=function(e){var t=e.split(" - ");return t.length>0?t[0]:e}(a)),a.includes("(")&&a.includes(")")&&(a=a.replace(/ *\([^)]*\) */g,""));var i=function(e,t){var a=e;return t.isRemix&&(a+=" "+t.remixCreator),t.isLive&&(a+=" ".concat(t.liveLocation)),t.versionName&&(a+=" ".concat(t.versionName)),a}(a,n),s=encodeURIComponent("".concat(i," ").concat(e.item.artists[0].name)),o=C+"https://api.genius.com/search?q="+s;N()({method:"GET",url:o,headers:{Authorization:"Bearer "+x},timeout:3e4}).then((function(e){t&&t(e.data)})).catch((function(e){console.error(e)}))},parseLyricsFromUrl:function(e,t){var a=C+e+"?react=1";N()({method:"GET",url:a,headers:{Authorization:"Bearer "+x},timeout:3e4}).then((function(e){if(t){var n="",i=function(e){var t=document.implementation.createHTMLDocument();return t.body.innerHTML=e,t.body}(e.request.responseText);if(i.querySelectorAll(".lyrics").length<=0){var s,o=i.getElementsByTagName("div"),r=0,l=Object(de.a)(o);try{for(l.s();!(s=l.n()).done;){var c=s.value,u=c.className.toLowerCase();if(u.includes("lyric")&&u.includes("container")){var h=c.innerHTML.replace(/<br>/g,"\n").replace(/<[^>]*>?/gm,"");h||(h+="\n"),n+=h,r<o.length&&(n+="\n"),r++}}}catch(g){l.e(g)}finally{l.f()}if(n){var m=pe(n);m=m.replace(/&amp;/g,"&"),t(m)}else console.error("Unable to parse lyrics correctly from page ".concat(a))}else{var d=i.querySelectorAll(".lyrics");if(d.length>0){var p=pe(d[0].textContent);p=p.replace("&amp;","&"),t(p)}else console.error("Unable to parse lyrics from old Genius layout")}}})).catch((function(e){console.error(e)}))},getRelevantResult:function(e,t){if(t){if(!(e&&e.length>0))return null;var a,n=Object(de.a)(e);try{for(n.s();!(a=n.n()).done;){var i=a.value,s=ge(i.result.primary_artist.name),o=ge(i.result.title),r=ge(t.name),l=ge(t.artists[0].name),c=!1;if(t.artists.length>1)for(var u=0;u<t.artists.length;u++){var h=ge(t.artists[u].name);if(s.includes(h)){c=!0;break}}if(!c){var m=s.includes(l),d=l.includes(s);(m||d)&&(c=!0)}var p=s.includes(l)&&o.includes(r),g=l.includes(s)&&r.includes(o);if(p||g||c)return i}}catch(v){n.e(v)}finally{n.f()}}}},ye=(a(449),function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(r.a)(this,a),n=t.call(this,e);var i=new X.a;return i.init(new $.a({dictPath:"./dict"})),n.state={playState:e.playState,auth:e.auth,originalLyrics:null,modifiedLyrics:null,lyricsSpotifyTrackName:null,lyricsInfo:null,loaded:!0,isRomanized:!1,isSimplified:!1,originalLyricLanguage:se,kuroshiro:i,shouldUpdateLyrics:!0,lastSearchDuration:0},n.updateLyrics=n.updateLyrics.bind(Object(d.a)(n)),n.onToggleRomanize=n.onToggleRomanize.bind(Object(d.a)(n)),n.resetLyricState=n.resetLyricState.bind(Object(d.a)(n)),n.onRetryLyricsBtn=n.onRetryLyricsBtn.bind(Object(d.a)(n)),n.onToggleSimplification=n.onToggleSimplification.bind(Object(d.a)(n)),n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){this.updateLyrics()}},{key:"componentDidUpdate",value:function(e){var t=this;e.playState!==this.props.playState&&this.setState({playState:this.props.playState},(function(){var a,n,i,s;null!==e.playState&&(null===(a=e.playState)||void 0===a||null===(n=a.item)||void 0===n?void 0:n.name)===(null===(i=t.props.playState)||void 0===i||null===(s=i.item)||void 0===s?void 0:s.name)||t.updateLyrics()})),e.auth!==this.props.auth&&this.setState({auth:this.props.auth})}},{key:"updateLyrics",value:function(){var e=this;if(this.state.playState&&this.state.loaded){this.setState({loaded:!1,shouldUpdateLyrics:!1,lyricsSpotifyTrackName:null});var t=Date.now();fe.search(this.state.playState,(function(a){if(a.response.hits.length>0){var n=fe.getRelevantResult(a.response.hits,e.state.playState.item);n?(console.log("Relevant Result: ".concat(n.result.full_title)),fe.parseLyricsFromUrl(n.result.url,(function(a){console.log("Loaded and set lyrics from ".concat(n.result.url));var i=function(e){var t=se,a=function(e){return e.match(/[\uac00-\ud7af]|[\u1100-\u11ff]|[\u3130-\u318f]|[\ua960-\ua97f]|[\ud7b0-\ud7ff]/g)}(e);null!==a&&(t=ce);var n=function(e){return e.match(/[\u3041-\u3093\u30a1-\u30f3]/g)}(e),i=function(e){return e.match(/[\u2E80-\u2FD5\u3190-\u319f\u3400-\u4DBF\u4E00-\u9FCC\uF900-\uFAAD]/g)}(e);null!==n&&null!==i?t=n.length>i.length?ue:re:null!==n?t=ue:null!==i&&(t="chinese");var s=function(e){return e.match(/^[\u0430\u0410\u0431\u0411\u0432\u0412\u0433\u0413\u0434\u0414\u0435\u0415\u0451\u0401\u0436\u0416\u0437\u0417\u0438\u0418\u0439\u0419\u043a\u041a\u043b\u041b\u043c\u041c\u043d\u041d\u043e\u041e\u043f\u041f\u0440\u0420\u0441\u0421\u0442\u0422\u0443\u0423\u0444\u0424\u0445\u0425\u0446\u0426\u0447\u0427\u0448\u0428\u0449\u0429\u044a\u042a\u044b\u042b\u044c\u042c\u044d\u042d\u044e\u042e\u044f\u042f]+$/)}(e);return null!==s&&(t=he),"chinese"===t&&(t=Object(me.isSimplified)(e)?re:le),null==a&&null==n&&null==i&&null==s&&(t=oe),t}(a);console.log("Original lyrics language: '".concat(i,"'"));var s=new Date(Date.now()-t);console.log("Search took '".concat(s.getSeconds(),".").concat(s.getMilliseconds(),"' seconds...")),e.setState({originalLyrics:a,modifiedLyrics:a,isRomanized:!1,originalLyricLanguage:i,isSimplified:i===re,lyricsInfo:n,loaded:!0,lyricsSpotifyTrackName:e.state.playState.item,lastSearchDuration:s},(function(){var t=_();t&&(t.autoRomanize&&e.state.originalLyricLanguage!==oe?e.onToggleRomanize():t.autoSimplifyChinese&&!e.state.isSimplified&&e.onToggleSimplification())}))}))):(console.log("No related lyrics found out of '".concat(a.response.hits.length,"' results for song '").concat(e.state.playState.item.artists[0].name," - ").concat(e.state.playState.item.name,"'")),e.setState({loaded:!0}),e.resetLyricState())}else console.log("Didn't find any search results on Genius"),e.setState({loaded:!0}),e.resetLyricState()}))}}},{key:"resetLyricState",value:function(){this.setState({originalLyrics:null,modifiedLyrics:null,lyricsInfo:null,isRomanized:!1,originalLyricLanguage:se})}},{key:"onToggleRomanize",value:function(){var e=this;if(this.state.originalLyrics){if(!this.state.isRomanized){var t="";switch(this.state.originalLyricLanguage){case ue:if(!this.state.kuroshiro){console.error("Unable to romanize Japanese - Error with Kuroshiro");break}this.state.kuroshiro.convert(this.state.originalLyrics,{to:"romaji",mode:"spaced"}).then((function(t){t=t.replace(/ +(?= )/g,""),e.setState({modifiedLyrics:t})}));break;case re:case le:t=ee.a.convertToPinyinString(this.state.originalLyrics," ",ee.a.WITH_TONE_MARK);break;case ce:t=ae.a.romanize(this.state.originalLyrics);break;case he:t=ie()().transform(this.state.originalLyrics," ")}this.setState({modifiedLyrics:t})}else if(this.state.originalLyricLanguage===re||this.state.originalLyricLanguage===le){var a=this.state.originalLyrics;a=this.state.isSimplified?ee.a.convertToSimplifiedChinese(a):ee.a.convertToTraditionalChinese(a),this.setState({modifiedLyrics:a})}else this.setState({modifiedLyrics:this.state.originalLyrics});this.setState({isRomanized:!this.state.isRomanized})}}},{key:"onRetryLyricsBtn",value:function(){var e=this;this.state.shouldUpdateLyrics||(this.setState({shouldUpdateLyrics:!0},(function(){return e.updateLyrics()})),console.log("Retrying lyrics at request of user"))}},{key:"onToggleSimplification",value:function(){var e=this.state.modifiedLyrics;e=this.state.isSimplified?ee.a.convertToTraditionalChinese(e):ee.a.convertToSimplifiedChinese(e),this.setState({modifiedLyrics:e,isSimplified:!this.state.isSimplified})}},{key:"render",value:function(){return i.a.createElement("div",{className:"py-2 w-100 h-100"},i.a.createElement("div",{className:"text-center h-100"},!this.state.loaded&&i.a.createElement("div",{className:"text-center my-3"},i.a.createElement("h6",null,"Finding lyrics..."),i.a.createElement(y.a,{className:"fa-spin",size:"3x",icon:R.k})),this.state.modifiedLyrics&&this.state.loaded&&i.a.createElement("div",{className:"h-100"},i.a.createElement(Y.a,{md:3,sm:3,className:"pr-4 pl-0 mb-2 text-right d-none d-sm-block",style:{height:"35px",position:"absolute",right:0,fontSize:"0.8rem"}},i.a.createElement("h6",{className:"mb-1"},"Lyric Info"),i.a.createElement("a",{href:this.state.lyricsInfo.result.url,className:"py-1"},this.state.lyricsInfo.result.full_title),this.state.lastSearchDuration&&i.a.createElement("div",null,"Found in ",this.state.lastSearchDuration.getSeconds(),".",this.state.lastSearchDuration.getMilliseconds(),"s"),this.state.originalLyricLanguage!==oe&&i.a.createElement(Z.a,null,i.a.createElement(Z.a.Check,{type:"switch",id:"romanize-switch",label:"Romanize",checked:this.state.isRomanized,onChange:this.onToggleRomanize})),!this.state.isRomanized&&(this.state.originalLyricLanguage===re||this.state.originalLyricLanguage===le)&&i.a.createElement(Z.a,null,i.a.createElement(Z.a.Check,{type:"switch",id:"convert-simplified-switch",label:"Convert To Simplified",checked:this.state.isSimplified,onChange:this.onToggleSimplification}))),i.a.createElement("div",{className:"lyrics-content",style:{fontSize:"".concat(_().lyricFontSize,"rem")}},this.state.modifiedLyrics)),this.state.playState&&!this.state.originalLyrics&&this.state.loaded&&i.a.createElement("div",{className:"d-flex flex-column"},i.a.createElement("a",{href:"https://genius.com/new"},i.a.createElement(v.a,{variant:"outline-light",className:"mt-2"},"Add to Genius")),i.a.createElement(v.a,{className:"mx-auto my-2",variant:"outline-light",onClick:this.onRetryLyricsBtn},"Retry Lyrics"))))}}]),a}(n.Component)),ke=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).state={contentSelectedCallback:e.onContentSelected,selections:["lyrics","settings"],selectedSelection:"lyrics"},n.onSelectContent=n.onSelectContent.bind(Object(d.a)(n)),n}return Object(l.a)(a,[{key:"onSelectContent",value:function(e){var t=e.target;this.setState({selectedSelection:t.dataset.tag}),this.state.contentSelectedCallback(t.dataset.tag)}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"genify-nav-bg w-100"},i.a.createElement(g.a,{className:"h-100 d-flex align-items-center"},this.state.selections&&this.state.selections.map((function(t,a){return i.a.createElement("div",{onClick:e.onSelectContent,className:"content-selector-item mx-auto ".concat(e.state.selectedSelection===t&&"active-selection"),"data-tag":t,key:t},i.a.createElement("h6",{"data-tag":t,className:"m-0"},t))}))))}}]),a}(n.Component),Se=a(54),be=a(78),Ee=a.n(be);function xe(e){var t;return i.a.createElement("div",{className:"d-flex"},i.a.createElement("div",null,e.name),i.a.createElement("div",{className:"ml-auto"},e.check&&i.a.createElement(Z.a,null,i.a.createElement(Z.a.Check,{checked:e.value,type:"switch",id:e.checkId,label:"","aria-label":e.name,onChange:function(t){e.onCheckToggled&&e.onCheckToggled(t.target.checked)}})),e.slider&&i.a.createElement(Ee.a,{value:null!==(t=e.value)&&void 0!==t?t:0,min:e.sliderMin,max:e.sliderMax,onChange:function(t){e.onSliderChanged&&e.onSliderChanged(parseFloat(t.target.value))},step:e.sliderStepSize,tooltip:"auto",variant:"primary"}),!e.check&&!e.slider&&i.a.createElement("div",null,e.value)))}var Ce=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(r.a)(this,a),n=t.call(this,e);var i={autoRomanize:!1,lyricFontSize:1},s=b.a.get(z,{path:""});if(s){var o=I(s);o&&(i=o)}else{var l=JSON.stringify(i);b.a.set(z,l,{path:"",expires:365})}return n.state={auth:e.auth,redirect:"",userProfile:null,settings:i},n.onSpotifySignOut=n.onSpotifySignOut.bind(Object(d.a)(n)),n.getLatestUserProfile=n.getLatestUserProfile.bind(Object(d.a)(n)),n.onAutoRomanizeToggled=n.onAutoRomanizeToggled.bind(Object(d.a)(n)),n.onSettingChanged=n.onSettingChanged.bind(Object(d.a)(n)),n.onLyricSizeChanged=n.onLyricSizeChanged.bind(Object(d.a)(n)),n.onAutoSimplifyChineseToggled=n.onAutoSimplifyChineseToggled.bind(Object(d.a)(n)),n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){this.getLatestUserProfile()}},{key:"componentDidUpdate",value:function(e){var t=this;e.auth!==this.props.auth&&this.setState({auth:this.props.auth},(function(){return t.getLatestUserProfile()}))}},{key:"onSettingChanged",value:function(){var e=JSON.stringify(this.state.settings);b.a.set(z,e,{path:"",expires:365})}},{key:"getLatestUserProfile",value:function(){var e=this;this.state.auth&&L.getCurrentUserProfile(this.state.auth.authToken,(function(t){e.setState({userProfile:t})}))}},{key:"onSpotifySignOut",value:function(){console.log("Signing out of Genify"),b.a.get(U)&&b.a.set(U,"",{path:"",expires:365}),this.setState({redirect:"/"})}},{key:"onAutoRomanizeToggled",value:function(e){var t=this;this.setState({settings:Object(Se.a)(Object(Se.a)({},this.state.settings),{},{autoRomanize:e})},(function(){t.onSettingChanged()}))}},{key:"onLyricSizeChanged",value:function(e){var t=this;this.setState({settings:Object(Se.a)(Object(Se.a)({},this.state.settings),{},{lyricFontSize:e})},(function(){t.onSettingChanged()}))}},{key:"onAutoSimplifyChineseToggled",value:function(e){var t=this;this.setState({settings:Object(Se.a)(Object(Se.a)({},this.state.settings),{},{autoSimplifyChinese:e})},(function(){t.onSettingChanged()}))}},{key:"render",value:function(){var e,t,a,n,s,o,r,l,c,u,h,d,p,f,S,b,E,x,C,T,N;return i.a.createElement("div",{className:"w-100 h-100"},i.a.createElement(g.a,{className:"py-2 px-5 scrollable-main-content"},i.a.createElement("h2",{className:"mb-4"},"App Settings"),i.a.createElement("h5",null,"Spotify"),i.a.createElement("div",{className:"d-flex px-3 my-3"},i.a.createElement("img",{alt:"Signed in user icon",src:null!==(e=null===(t=this.state.userProfile)||void 0===t||null===(a=t.images[0])||void 0===a?void 0:a.url)&&void 0!==e?e:"https://via.placeholder.com/50",style:{maxHeight:"50px",maxWidth:"50px"}}),i.a.createElement("div",{className:"px-3"},i.a.createElement("h6",null,null!==(n=null===(s=this.state.userProfile)||void 0===s?void 0:s.display_name)&&void 0!==n?n:"No Display Name"),i.a.createElement("h6",{style:{color:"rgb(200, 200, 200)",fontSize:"0.8rem"}},(null===(o=this.state.userProfile)||void 0===o?void 0:o.product)?"SPOTIFY "+(null===(r=this.state.userProfile)||void 0===r?void 0:r.product.toUpperCase()):"UNKNOWN")),i.a.createElement("a",{href:null===(l=this.state.userProfile)||void 0===l||null===(c=l.external_urls)||void 0===c?void 0:c.spotify,target:"noopener",className:"ml-auto"},i.a.createElement(v.a,{variant:"outline-success"},i.a.createElement(y.a,{icon:R.p})))),i.a.createElement(xe,{name:"Account Id",value:null!==(u=null===(h=this.state.userProfile)||void 0===h?void 0:h.id)&&void 0!==u?u:"Unknown"}),i.a.createElement(xe,{name:"Followers",value:null!==(d=null===(p=this.state.userProfile)||void 0===p||null===(f=p.followers)||void 0===f?void 0:f.total)&&void 0!==d?d:"Unknown"}),i.a.createElement(xe,{name:"Region",value:null!==(S=null===(b=this.state.userProfile)||void 0===b?void 0:b.country)&&void 0!==S?S:"Antarctica"}),i.a.createElement("div",{className:"w-100 text-right my-2"},i.a.createElement(v.a,{variant:"success",onClick:this.onSpotifySignOut,className:"px-4"},i.a.createElement(y.a,{className:"mr-2",icon:k.b}),"Sign Out")),i.a.createElement("div",{className:"pt-3"},i.a.createElement(xe,{name:"Enable Web Playback",value:"Coming soon..."})),i.a.createElement("div",{className:"horizontal-separator"}),i.a.createElement("h5",null,"Lyrics"),i.a.createElement(xe,{name:"Automatically romanize Chinese/Japanese/Korean/Russian",value:null!==(E=null===(x=this.state.settings)||void 0===x?void 0:x.autoRomanize)&&void 0!==E&&E,check:!0,checkId:"auto-romanize-check",onCheckToggled:this.onAutoRomanizeToggled}),i.a.createElement(xe,{name:"Font size",value:null!==(C=null===(T=this.state.settings)||void 0===T?void 0:T.lyricFontSize)&&void 0!==C?C:1,slider:!0,sliderMin:1,sliderMax:2,sliderStepSize:.1,onSliderChanged:this.onLyricSizeChanged}),i.a.createElement(xe,{name:"Automatically convert Chinese lyrics to Simplified",value:null===(N=this.state.settings)||void 0===N?void 0:N.autoSimplifyChinese,check:!0,checkId:"auto-simplify-check",onCheckToggled:this.onAutoSimplifyChineseToggled}),i.a.createElement("div",{className:"horizontal-separator"}),i.a.createElement("h4",null,"Credits"),i.a.createElement("div",{className:"d-flex mb-2"},i.a.createElement("p",{className:"my-0"},"Created By"),i.a.createElement("div",{className:"ml-auto d-flex"},i.a.createElement("a",{href:"https://joshlmao.com",className:"mx-2"},i.a.createElement("p",{className:"my-0"},"JoshLmao")),i.a.createElement("a",{href:"https://github.com/JoshLmao",target:"noopener",className:"mx-2"},i.a.createElement(y.a,{icon:k.a})),i.a.createElement("a",{href:"https://twitter.com/JoshLmao",target:"noopener",className:"mx-2"},i.a.createElement(y.a,{icon:k.c})))),i.a.createElement("p",null,"If you enjoy this app, please consider supporting me through one of the options below. If not, thank you for using and enjoying the app! ",i.a.createElement("span",{role:"img","aria-label":"hug emoji"},"\ud83e\udd17")),i.a.createElement("div",{className:"w-100 text-center"},i.a.createElement("iframe",{className:"mx-auto",title:"spotify follow joshlmao",src:"https://open.spotify.com/follow/1/?uri=spotify:user:1121645175&size=detail&theme=dark",width:"300",height:"56",scrolling:"no",style:{border:"none",overflow:"hidden"},allowtransparency:"true"})),i.a.createElement("p",{className:"text-center"},i.a.createElement("a",{href:"https://github.com/sponsors/JoshLmao",className:"m-2"},i.a.createElement("img",{alt:"Github Sponsor Advert",src:"/img/github-sponsor.png",className:"my-2",height:"50px"})),i.a.createElement("a",{href:"https://paypal.me/xjoshlmao",className:"m-2"},i.a.createElement("img",{alt:"Paypal Donation Advert",src:"https://i.imgur.com/UfSd0gP.png",className:"my-2",style:{height:"50px"}})))),this.state.redirect&&i.a.createElement(m.a,{to:this.state.redirect}))}}]),a}(n.Component),Te=a(468),Ne=a(221),we=a(469),Pe=a(462),Oe=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).state={devices:e.devices,auth:e.auth,showDevicesPopover:!1,popoverLocationTarget:null},n.onSelectPlaybackDevice=n.onSelectPlaybackDevice.bind(Object(d.a)(n)),n.handleDisplayDeviceSelector=n.handleDisplayDeviceSelector.bind(Object(d.a)(n)),n}return Object(l.a)(a,[{key:"componentDidUpdate",value:function(e){e.devices!==this.props.devices&&this.setState({devices:this.props.devices}),e.auth!==this.props.auth&&this.setState({auth:this.props.auth})}},{key:"handleDisplayDeviceSelector",value:function(e){this.setState({showDevicesPopover:!this.state.showDevicesPopover,popoverLocationTarget:e.target})}},{key:"onSelectPlaybackDevice",value:function(e){var t=e.target.dataset.deviceid;L.setPlaybackDevice(this.state.auth.authToken,t,!0),this.state.devices.find((function(e){return!0===e.is_active})).is_active=!1,this.state.devices.find((function(e){return e.id===t})).is_active=!0}},{key:"render",value:function(){var e=this;return i.a.createElement(Te.a,{placement:"bottom",trigger:"focus",overlay:i.a.createElement(we.a,Object.assign({id:"devices-popover",className:"genify-light-background"},this.props),i.a.createElement(we.a.Title,{as:"h3",className:"playback-devices-title text-center"},"Connect to a device"),i.a.createElement(we.a.Content,null,i.a.createElement(Pe.a,{variant:"flush"},this.state.devices&&this.state.devices.map((function(t,a){return i.a.createElement(Pe.a.Item,{action:!0,onClick:e.onSelectPlaybackDevice,key:t.id,className:"playback-device-item ".concat(t.is_active?"active-device":""),"data-deviceid":t.id},i.a.createElement(y.a,{icon:A(t.type),className:"mr-2"}),t.name)})),!this.state.devices&&i.a.createElement(y.a,{className:"mx-auto text-white",size:"2x",icon:R.k,spin:!0}))))},i.a.createElement(v.a,{variant:"outline-light",onClick:this.handleDisplayDeviceSelector},i.a.createElement(y.a,{icon:R.b})))}}]),a}(n.Component);function je(e){var t=(e/1e3).toFixed(0),a=Math.floor(t/60),n="";return a>59&&(a=(a-=60*(n=(n=Math.floor(a/60))>=10?n:"0"+n))>=10?a:"0"+a),t=(t=Math.floor(t%60))>=10?t:"0"+t,""!==n?n+":"+a+":"+t:a+":"+t}function Re(e){var t="https://via.placeholder.com/75";e&&e.item&&(e.item.album&&e.item.album.images.length>0&&(t=e.item.album.images[0].url));return t}var De=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n,i;return Object(r.a)(this,a),(i=t.call(this,e)).state={auth:e.auth,playState:e.playState,volumePercent:e.playState?null===(n=e.playState.device)||void 0===n?void 0:n.volume_percent:0,trackProgressMs:e.playState?e.playState.progress_ms:0,isChangingTrackProgress:!1},i.onPlayPause=i.onPlayPause.bind(Object(d.a)(i)),i.onNextTrack=i.onNextTrack.bind(Object(d.a)(i)),i.onPreviousTrack=i.onPreviousTrack.bind(Object(d.a)(i)),i.onToggleVolumeMute=i.onToggleVolumeMute.bind(Object(d.a)(i)),i.onVolumeChanged=i.onVolumeChanged.bind(Object(d.a)(i)),i.onFinishVolumeChanged=i.onFinishVolumeChanged.bind(Object(d.a)(i)),i.onProgressChanged=i.onProgressChanged.bind(Object(d.a)(i)),i.onFinishProgressChanged=i.onFinishProgressChanged.bind(Object(d.a)(i)),i.updatePlaybackDevices=i.updatePlaybackDevices.bind(Object(d.a)(i)),i.onKeyUp=i.onKeyUp.bind(Object(d.a)(i)),i}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this;setInterval((function(){e.updatePlaybackDevices()}),3e3)}},{key:"componentDidUpdate",value:function(e){var t,a,n;e.playState!==this.props.playState&&this.setState({playState:this.props.playState,volumePercent:null===(t=this.props.playState)||void 0===t||null===(a=t.device)||void 0===a?void 0:a.volume_percent,trackProgressMs:null===(n=this.props.playState)||void 0===n?void 0:n.progress_ms});e.auth!==this.props.auth&&this.setState({auth:this.props.auth})}},{key:"onPlayPause",value:function(){this.state.playState&&(this.state.playState.is_playing?L.pause(this.state.auth.authToken):L.resume(this.state.auth.authToken))}},{key:"onNextTrack",value:function(){L.nextTrack(this.state.auth.authToken)}},{key:"onPreviousTrack",value:function(){L.previousTrack(this.state.auth.authToken)}},{key:"onToggleVolumeMute",value:function(){var e;this.state.playState&&((null===(e=this.state.playState.device)||void 0===e?void 0:e.volume_percent)>0?L.setVolume(this.state.auth.authToken,0):L.setVolume(this.state.auth.authToken,25))}},{key:"onVolumeChanged",value:function(e){this.setState({volumePercent:parseInt(e.target.value)})}},{key:"onFinishVolumeChanged",value:function(){var e;this.state.volumePercent!==(null===(e=this.state.playState.device)||void 0===e?void 0:e.volume_percent)&&(console.log("Web API: Set volume to "+this.state.volumePercent),L.setVolume(this.state.auth.authToken,this.state.volumePercent))}},{key:"onProgressChanged",value:function(e){this.setState({trackProgressMs:parseInt(e.target.value)}),this.state.isChangingTrackProgress||this.setState({isChangingTrackProgress:!0})}},{key:"onFinishProgressChanged",value:function(){this.state.playState&&this.state.playState.progress_ms!==this.state.trackProgressMs&&L.seek(this.state.auth.authToken,this.state.trackProgressMs),this.setState({isChangingTrackProgress:!1})}},{key:"updatePlaybackDevices",value:function(){var e,t=this;L.getPlaybackDevices(null===(e=this.state.auth)||void 0===e?void 0:e.authToken,(function(e){var a=e.devices.sort((function(e,t){var a=e.name.toUpperCase(),n=t.name.toUpperCase();return a<n?-1:a>n?1:0})).sort((function(e,t){return e.is_active?-1:t.is_active?1:0}));t.setState({playbackDevices:a})}))}},{key:"onKeyUp",value:function(e,t,a){switch(e){case"space":this.onPlayPause();break;case"left":L.seek(this.state.auth.authToken,this.state.trackProgressMs-5e3);break;case"right":L.seek(this.state.auth.authToken,this.state.trackProgressMs+5e3)}}},{key:"render",value:function(){var e,t,a,n,s,o,r,l,c,u,h,m,d,g,f,k,S,b,E;return window.onkeydown=function(e){return!(32==e.keyCode&&e.target==document.body)},i.a.createElement(Ne.a,{keyName:"space,left,right",onKeyUp:this.onKeyUp},i.a.createElement(p.a,{className:"w-100 mx-0 genify-player"},i.a.createElement(Y.a,{xl:3,lg:3,md:4,sm:5,xs:12},i.a.createElement("div",{className:"d-flex align-items-center my-auto"},this.state.playState&&i.a.createElement("a",{href:this.state.playState?null===(e=this.state.playState)||void 0===e||null===(t=e.item)||void 0===t||null===(a=t.album)||void 0===a||null===(n=a.external_urls)||void 0===n?void 0:n.spotify:"#",className:"ml-2 p-2"},i.a.createElement("img",{className:"album-art",alt:this.state.playState?(null===(s=this.state.playState)||void 0===s||null===(o=s.item)||void 0===o?void 0:o.artists[0].name)+"Album Art":"Unknown Album",src:Re(this.state.playState),style:{maxWidth:"75px",maxHeight:"75px"}})),i.a.createElement("div",{className:"w-100 ml-2 song-info"},i.a.createElement("a",{href:this.state.playState?null===(r=this.state.playState)||void 0===r||null===(l=r.item)||void 0===l||null===(c=l.external_urls)||void 0===c?void 0:c.spotify:"#"},i.a.createElement("h6",null,this.state.playState?null===(u=this.state.playState)||void 0===u||null===(h=u.item)||void 0===h?void 0:h.name:"")),i.a.createElement("h6",null,this.state.playState?function(e){var t;if(!e)return null;var a=null===(t=e.item)||void 0===t?void 0:t.artists;return a?i.a.createElement("div",{className:"d-flex"},a.map((function(e,t){return i.a.createElement("div",{className:"d-flex",key:e.name},i.a.createElement("a",{href:e.external_urls.spotify},e.name),t<a.length-1&&i.a.createElement("div",{className:"pr-1"}," ,"))}))):null}(this.state.playState):""))),!this.state.playState&&i.a.createElement("div",{className:"my-auto"},i.a.createElement("h6",null,"No song currently playing."),i.a.createElement("h6",null,"Play a song to get started!"))),i.a.createElement(Y.a,{xl:6,lg:6,md:5,sm:7,className:"d-none d-sm-block my-auto"},i.a.createElement("div",{className:"d-flex align-items-center my-1"},i.a.createElement("div",{className:"mx-auto my-1"},i.a.createElement(v.a,{className:"mx-2",variant:"outline-light",onClick:this.onPreviousTrack},i.a.createElement(y.a,{icon:R.l})),i.a.createElement(v.a,{className:"mx-2",variant:"outline-light",onClick:this.onPlayPause},i.a.createElement(y.a,{icon:(null===(m=this.state.playState)||void 0===m?void 0:m.is_playing)?R.h:R.i})),i.a.createElement(v.a,{className:"mx-2",variant:"outline-light",onClick:this.onNextTrack},i.a.createElement(y.a,{icon:R.m})))),i.a.createElement("div",{className:"d-flex align-items-center my-1"},i.a.createElement("h6",{className:"my-auto mx-2"},this.state.playState&&je(this.state.isChangingTrackProgress?this.state.trackProgressMs:this.state.playState.progress_ms),!this.state.playState&&"0:00"),i.a.createElement("div",{className:"w-100",onMouseUp:this.onFinishProgressChanged},i.a.createElement(Ee.a,{value:null!==(d=this.state.trackProgressMs)&&void 0!==d?d:0,min:0,max:this.state.playState?null===(g=this.state.playState)||void 0===g||null===(f=g.item)||void 0===f?void 0:f.duration_ms:100,onChange:this.onProgressChanged,tooltip:"off"})),i.a.createElement("h6",{className:"my-auto mx-2"},this.state.playState&&je(null===(k=this.state.playState)||void 0===k||null===(S=k.item)||void 0===S?void 0:S.duration_ms),!this.state.playState&&"9:59"))),i.a.createElement(Y.a,{xl:3,lg:3,md:3,className:"d-none d-md-block"},i.a.createElement("div",{className:"d-flex align-items-center my-auto h-100"},i.a.createElement(Oe,{devices:this.state.playbackDevices,auth:this.state.auth}),i.a.createElement(v.a,{className:"mx-2",variant:"outline-light",onClick:this.onToggleVolumeMute},i.a.createElement(y.a,{icon:0===this.state.volumePercent?R.q:R.r})),i.a.createElement("div",{onMouseUp:this.onFinishVolumeChanged,className:"w-100"},i.a.createElement(Ee.a,{value:null!==(b=this.state.volumePercent)&&void 0!==b?b:0,onChange:this.onVolumeChanged,tooltip:"auto",variant:"primary"}))),this.state.playState&&i.a.createElement(Te.a,{placement:"left",delay:{show:0,hide:500},overlay:i.a.createElement("div",{className:"genify-dark-background px-2 py-1 mr-1",style:{fontSize:"0.75rem"}},"State changed at ",new Date(null===(E=this.state.playState)||void 0===E?void 0:E.timestamp).toLocaleTimeString())},i.a.createElement(y.a,{className:"m-2 mr-3",style:{position:"absolute",top:0,right:0,color:"rgb(80, 80, 80)"},size:"sm",icon:R.e})))))}}]),a}(n.Component),Ae=a(220),Le="short_term";function Ue(e){return i.a.createElement(Ae.a,{action:!0,"data-uri":e.uri,"data-index":e.index,onClick:e.onSelectMedia,className:""},i.a.createElement("div",{className:"d-flex",style:{pointerEvents:"none"}},i.a.createElement("img",{src:e.mediaArtUrl,alt:e.mediaTitle,className:"pr-2",height:e.height}),i.a.createElement("div",{className:"my-auto text-left"},i.a.createElement("h5",{className:"mb-0"},e.mediaTitle),i.a.createElement("h6",{className:"mb-0",style:{fontSize:"1rem"}},e.mediaSubtitle))))}var ze=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n,i,s;return Object(r.a)(this,a),(s=t.call(this,e)).state={auth:e.auth,suggestAmount:null!==(n=e.suggestAmount)&&void 0!==n?n:5,suggestTerm:null!==(i=e.suggestTerm)&&void 0!==i?i:Le,topTracks:null,recentPlayed:null,devices:null,loadedTracks:!1,loadedPlayed:!1,selectedTrackURI:null,selectedDeviceId:null,showDeviceModal:!1},s.updateSpotifyData=s.updateSpotifyData.bind(Object(d.a)(s)),s.getTracks=s.getTracks.bind(Object(d.a)(s)),s.getRecentPlayed=s.getRecentPlayed.bind(Object(d.a)(s)),s.onSelectTrack=s.onSelectTrack.bind(Object(d.a)(s)),s.onSelectRecentTrack=s.onSelectRecentTrack.bind(Object(d.a)(s)),s.toggleDeviceModal=s.toggleDeviceModal.bind(Object(d.a)(s)),s.confirmDeviceChoice=s.confirmDeviceChoice.bind(Object(d.a)(s)),s.onChangedSelectedDevice=s.onChangedSelectedDevice.bind(Object(d.a)(s)),s}return Object(l.a)(a,[{key:"componentDidMount",value:function(){this.updateSpotifyData()}},{key:"componentDidUpdate",value:function(e){var t=this;e.auth!==this.props.auth&&this.setState({auth:this.props.auth},(function(){t.updateSpotifyData()})),e.suggestAmount!==this.props.suggestAmount&&this.setState({suggestAmount:this.props.suggestAmount})}},{key:"updateSpotifyData",value:function(){var e=this;this.setState({loadedPlayed:!1,loadedTracks:!1}),this.getTracks(),this.getRecentPlayed(),L.getPlaybackDevices(this.state.auth.authToken,(function(t){e.setState({devices:t.devices,selectedDeviceId:t.devices.length>0?t.devices[0].id:null})}))}},{key:"getTracks",value:function(){var e=this;this.state.auth&&L.getUsersTopTracks(this.state.auth.authToken,this.state.suggestAmount,this.state.suggestTerm,(function(t){e.setState({topTracks:t,loadedTracks:!0})}))}},{key:"getRecentPlayed",value:function(){var e=this;this.state.auth&&L.getUsersRecentlyPlayed(this.state.auth.authToken,50,(function(t){var a=t.items.sort((function(){return.5-Math.random()})).slice(0,e.state.suggestAmount);t.items=a,e.setState({recentPlayed:t,loadedPlayed:!0})}))}},{key:"onSelectTrack",value:function(e){var t=parseInt(e.target.dataset.index);t>=0&&this.setState({selectedTopTrackIndex:t,showDeviceModal:!0})}},{key:"onSelectRecentTrack",value:function(e){var t=parseInt(e.target.dataset.index);t>=0&&this.setState({selectedRecentTrackIndex:t,showDeviceModal:!0})}},{key:"toggleDeviceModal",value:function(){this.setState({showDeviceModal:!this.state.showDeviceModal})}},{key:"confirmDeviceChoice",value:function(){var e=null;this.state.selectedTopTrackIndex>=0?e=this.state.topTracks.items[this.state.selectedTopTrackIndex]:this.state.selectedRecentTrackIndex>=0&&(e=this.state.recentPlayed.items[this.state.selectedRecentTrackIndex].track),e?(console.log("Selected to play '".concat(e.artists[0].name," - ").concat(e.name,"' in album '").concat(e.album.uri,"' on device '").concat(this.state.selectedDeviceId,"'")),L.playContext(this.state.auth.authToken,this.state.selectedDeviceId,e.album.uri,e.track_number-1,0)):console.error("Unable to choose a top or recent track to play"),this.toggleDeviceModal(),this.setState({selectedTopTrackIndex:null,selectedRecentTrackIndex:null})}},{key:"onChangedSelectedDevice",value:function(e){var t=e.target.selectedIndex,a=this.state.devices[t].id;this.setState({selectedDeviceId:a})}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"lyrics-content"},i.a.createElement(g.a,null,i.a.createElement("div",{className:"text-center py-3"},"Hmm... seems you're not listening to anything right now. May I suggest one of these?"),i.a.createElement(p.a,{className:"py-2"},i.a.createElement(Y.a,{className:"my-2",md:{span:5,offset:1}},i.a.createElement("h5",{className:"text-center"},"Top Recent Tracks"),!this.state.loadedTracks&&i.a.createElement("div",{className:"text-center my-3"},i.a.createElement(y.a,{icon:R.k,className:"fa-spin mx-auto",size:"3x"})),i.a.createElement(Pe.a,{className:"genify-list-group"},this.state.topTracks&&this.state.topTracks.items.map((function(t,a){return i.a.createElement(Ue,{key:"top-".concat(a),index:a,uri:t.uri,onSelectMedia:e.onSelectTrack,mediaArtUrl:t.album.images[2].url,mediaTitle:t.name,mediaSubtitle:t.artists[0].name,height:50})})))),i.a.createElement(Y.a,{className:"my-2",md:{span:5,offset:1}},i.a.createElement("h5",{className:"text-center"},"Recently Played"),!this.state.loadedPlayed&&i.a.createElement("div",{className:"text-center my-3"},i.a.createElement(y.a,{icon:R.k,className:"fa-spin",size:"3x"})),i.a.createElement(Pe.a,{className:"genify-list-group"},this.state.recentPlayed&&this.state.recentPlayed.items.map((function(t,a){return"artist"===t.type?i.a.createElement("h5",null,t.name):i.a.createElement(Ue,{key:"played-".concat(a),index:a,uri:t.track.uri,onSelectMedia:e.onSelectRecentTrack,mediaArtUrl:t.track.album.images[0].url,mediaTitle:t.track.name,mediaSubtitle:t.track.artists[0].name,height:50})}))))),i.a.createElement(q.a,{show:this.state.showDeviceModal,onHide:this.toggleDeviceModal,className:"genify-modal"},i.a.createElement(q.a.Header,{closeButton:!0},i.a.createElement(q.a.Title,null,"Select a Playback Device")),i.a.createElement(q.a.Body,null,i.a.createElement("div",{className:"mb-2"},"Great! Now select a device to start playing music on"),i.a.createElement(Z.a.Group,null,i.a.createElement(Z.a.Control,{as:"select",onChange:this.onChangedSelectedDevice,className:"genify-select"},this.state.devices&&this.state.devices.map((function(e,t){return i.a.createElement("option",{key:e.id,"data-id":e.id},e.name)}))))),i.a.createElement(q.a.Footer,null,i.a.createElement(v.a,{variant:"outline-light",onClick:this.toggleDeviceModal},"Close"),i.a.createElement(v.a,{variant:"light",onClick:this.confirmDeviceChoice},"Confirm")))))}}]),a}(n.Component),Ie=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(r.a)(this,a),n=t.call(this,e);var i="",s=null,o=!1;return null===(s=I(b.a.get(U)))?(i="/?auth=invalid",console.log("No auth in cookies or corrupted, going home")):(s.expireDate=new Date(s.expireDate),s.expireDate<Date.now()?s.refreshToken?(console.log("Auth expired at '".concat(s.expireDate.toLocaleString(),"'. Using refreshToken to get new auth")),o=!0,n.refreshAuth(s.refreshToken)):(b.a.remove(U),i="/?auth=expired",console.log("Auth found but has expired")):console.log("Auth found. Expires at '".concat(s.expireDate.toLocaleString(),"'"))),n.state={auth:s,playState:void 0,isRefreshingAuth:o,refreshAuthRoutine:null,spotifyUpdateRoutine:null,infoMessage:"",showInfoMessage:!1,redirect:i,mainContentPanel:"lyrics",toastInfo:null},n.initService=n.initService.bind(Object(d.a)(n)),n.refreshAuth=n.refreshAuth.bind(Object(d.a)(n)),n.processUpdatedState=n.processUpdatedState.bind(Object(d.a)(n)),n.onContentPanelSelected=n.onContentPanelSelected.bind(Object(d.a)(n)),n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){null!==this.state.auth||this.state.isRefreshingAuth||this.setState({redirect:"/?auth=invalid"}),null===this.state.auth||this.state.isRefreshingAuth||this.initService()}},{key:"initService",value:function(){var e=this;if(this.state.auth){var t=L.getRequiredScopes();this.state.auth.scopes.length<t.length&&this.setState({toastInfo:{title:"New authentification required",message:"Genify has been updated recently with new features! Please Sign Out and Sign In again to enable them. You can 'Sign Out' under 'Settings'"}})}if(L.getCurrentPlaybackState(this.state.auth.authToken,this.processUpdatedState),!this.state.spotifyUpdateRoutine){var a=setInterval((function(){var t;null===(t=e.state.auth)||null!=t&&t.expireDate<Date.now()||L.getCurrentPlaybackState(e.state.auth.authToken,e.processUpdatedState)}),2e3);this.setState({updateRoutine:a})}if(!this.state.refreshAuthRoutine){var n=this.state.auth.expireDate-new Date(Date.now()),i=setTimeout((function(){console.log("Auth will expire in ".concat(3," minute(s). Refreshing...")),e.setState({refreshAuthRoutine:null}),e.refreshAuth(e.state.auth.refreshToken)}),n-18e4);this.setState({refreshAuthRoutine:i})}}},{key:"processUpdatedState",value:function(e){var t,a,n;!e&&void 0===this.state.playState||!e&&this.state.playState?console.log("SPOTIFY INACTIVE"):(null===e||void 0===e||null===(t=e.item)||void 0===t?void 0:t.name)!==(null===(a=this.state.playState)||void 0===a||null===(n=a.item)||void 0===n?void 0:n.name)&&console.log("SPOTIFY TRACK CHANGED | "+function(e){var t;if(!e)return null;var a=null===(t=e.item)||void 0===t?void 0:t.artists;return a?a.map((function(e){return e.name})).join(", "):void 0}(e)+" - "+e.item.name),this.setState({playState:e})}},{key:"refreshAuth",value:function(e){var t=this;this.setState({isRefreshingAuth:!0}),L.refreshAuth(e,(function(e){var a=L.parseAuth(e);if(a){console.log("Successfully refreshed auth. Expires at '".concat(a.expireDate.toLocaleString(),"'"));var n=JSON.stringify(a);b.a.set(U,n,{path:"",expires:365})}else console.error("Error when trying to refresh auth"),b.a.remove(U),t.setState({redirect:"/?auth=refresh_error"});t.setState({isRefreshingAuth:!1,auth:a},(function(){t.initService()}))}))}},{key:"onContentPanelSelected",value:function(e){e!==this.state.mainContentPanel&&this.setState({mainContentPanel:e})}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"genify-home genify-dark-background"},i.a.createElement(p.a,{className:"mx-0"},i.a.createElement(De,{playState:this.state.playState,auth:this.state.auth})),i.a.createElement("div",{className:"main-content-container"},i.a.createElement(p.a,{className:"content-nav mx-0"},i.a.createElement(ke,{onContentSelected:this.onContentPanelSelected})),i.a.createElement(p.a,{className:"focused-content-container mx-0"},i.a.createElement("div",{className:"w-100 h-100 "+("lyrics"===this.state.mainContentPanel?"d-block":"d-none")},this.state.isRefreshingAuth&&i.a.createElement("div",{className:"text-center my-3"},i.a.createElement("h6",null,"Refreshing user authentification..."),i.a.createElement(y.a,{className:"fa-spin",size:"3x",icon:R.k})),!this.state.isRefreshingAuth&&void 0!==this.state.playState&&null!==this.state.playState&&i.a.createElement(ye,{playState:this.state.playState,auth:this.state.auth}),!this.state.isRefreshingAuth&&void 0!==this.state.playState&&null===this.state.playState&&i.a.createElement(ze,{auth:this.state.auth,suggestAmount:5})),i.a.createElement("div",{className:"w-100 h-100 "+("settings"===this.state.mainContentPanel?"d-block":"d-none")},i.a.createElement(Ce,{auth:this.state.auth})))),this.state.redirect&&i.a.createElement(m.a,{to:this.state.redirect}),this.state.toastInfo&&i.a.createElement(f.a,{className:"genify-toast m-2 mr-4",show:null!==this.state.toastInfo,onClose:function(){return e.setState({toastInfo:null})},style:{position:"absolute",bottom:0,right:0}},i.a.createElement(f.a.Header,null,i.a.createElement("div",{className:"mr-auto"},i.a.createElement("strong",null,this.state.toastInfo.title))),i.a.createElement(f.a.Body,null,this.state.toastInfo.message)))}}]),a}(n.Component),_e=(a(451),a(452),function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n,i;Object(r.a)(this,a),i=t.call(this,e);var s={};if(null===(n=e.location)||void 0===n?void 0:n.search){var o=e.location.search.substring(1).split("&");if(o.length<=2){var l,c=Object(de.a)(o);try{for(c.s();!(l=c.n()).done;){var u=l.value,h=u.split("=");u.includes("code")?s.code=h[1]:u.includes("state")?s.state=h[1]:u.includes("error")&&(s.error=h[1])}}catch(m){c.e(m)}finally{c.f()}}}return i.state={exchangeData:s,redirect:null},i}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this;if(this.state.exchangeData){if(this.state.exchangeData.state&&"genify-app"!==this.state.exchangeData.state)return console.error("Spotify state doesn't match returned state"),void this.setState({redirect:"/?auth=state_error"});this.state.exchangeData.error&&this.setState({redirect:"/?auth="+this.state.exchangeData.error}),this.state.exchangeData.code&&L.exchangePKCECode(this.state.exchangeData.code,(function(t){var a=L.parseAuth(t);if(a){var n=JSON.stringify(a);b.a.set(U,n,{path:"",expires:365}),console.log("Successfully saved auth! Redirecting..."),setTimeout((function(){e.setState({redirect:"/app"})}),100)}else console.error("Unable to parse and save auth")}))}}},{key:"render",value:function(){return i.a.createElement("div",{className:"h-100 w-100 spotify-black"},i.a.createElement("h3",{className:"text-center pt-5"},"Redirecting..."),i.a.createElement("div",{className:"mx-auto",style:{width:"50px"}},i.a.createElement(y.a,{className:"fa-spin",size:"3x",icon:R.k})),this.state.redirect&&i.a.createElement(m.a,{to:this.state.redirect}))}}]),a}(n.Component)),Me=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return i.a.createElement(h.a,{basename:""},i.a.createElement(H,null),i.a.createElement(m.d,null,i.a.createElement(m.b,{exact:!0,path:"/",component:M}),i.a.createElement(m.b,{exact:!0,path:"/app",component:Ie}),i.a.createElement(m.b,{exact:!0,path:"/callback",component:_e}),i.a.createElement(m.b,{component:W})))}}]),a}(n.Component),Fe=(a(453),i.a.createElement(i.a.StrictMode,null,i.a.createElement(Me,null)));o.a.render(Fe,document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[224,1,2]]]);
//# sourceMappingURL=main.fb33f9f6.chunk.js.map